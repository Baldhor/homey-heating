module.exports=function(e){var t={};function n(i){if(t[i])return t[i].exports;var r=t[i]={i:i,l:!1,exports:{}};return e[i].call(r.exports,r,r.exports,n),r.l=!0,r.exports}return n.m=e,n.c=t,n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)n.d(i,r,function(t){return e[t]}.bind(null,r));return i},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=58)}({0:function(e,t){e.exports=require("./tsyringe")},1:function(e,t){e.exports=require("./services")},2:function(e,t){e.exports=require("lodash")},21:function(e,t){e.exports=require("reflect-metadata")},58:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n(21);const i=n(0),r=n(59),o=n(60),a=n(61),c=n(62),s=n(63);console.log("Bootstrapping API"),e.exports=[...c.default,...r.default,...o.default,...s.default,...a.default].map(e=>i.container.resolve(e))},59:function(e,t,n){"use strict";var i=this&&this.__decorate||function(e,t,n,i){var r,o=arguments.length,a=o<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var c=e.length-1;c>=0;c--)(r=e[c])&&(a=(o<3?r(a):o>3?r(t,n,a):r(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a},r=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},o=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(r,o){function a(e){try{s(i.next(e))}catch(e){o(e)}}function c(e){try{s(i.throw(e))}catch(e){o(e)}}function s(e){e.done?r(e.value):new n(function(t){t(e.value)}).then(a,c)}s((i=i.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});const a=n(1),c=n(0),s=n(9);let u=class extends s.ApiBase{constructor(e,t){super("PUT","/mode"),this.manager=e,this.scheduler=t}execute(e){return o(this,void 0,void 0,function*(){const t=e.body.mode;return this.manager.operationMode=t,yield this.manager.applyPlans(),yield this.scheduler.start(),s.SUCCESS})}};u=i([c.injectable(),r("design:paramtypes",[a.HeatingManagerService,a.HeatingSchedulerService])],u);let l=class extends s.ApiBase{constructor(e){super("GET","/mode"),this.manager=e}execute(){return o(this,void 0,void 0,function*(){return this.manager.operationMode})}};l=i([c.injectable(),r("design:paramtypes",[a.HeatingManagerService])],l),t.default=[u,l]},6:function(e,t){e.exports=require("./helper")},60:function(e,t,n){"use strict";var i=this&&this.__decorate||function(e,t,n,i){var r,o=arguments.length,a=o<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var c=e.length-1;c>=0;c--)(r=e[c])&&(a=(o<3?r(a):o>3?r(t,n,a):r(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a},r=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},o=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(r,o){function a(e){try{s(i.next(e))}catch(e){o(e)}}function c(e){try{s(i.throw(e))}catch(e){o(e)}}function s(e){e.done?r(e.value):new n(function(t){t(e.value)}).then(a,c)}s((i=i.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});const a=n(6),c=n(1),s=n(2),u=n(0),l=n(9);let f=class extends l.ApiBase{constructor(e){super("GET","/resetplans"),this.manager=e}execute(){return o(this,void 0,void 0,function*(){return this.manager.replacePlans(a.DEFAULT_HEATING_PLAN),yield this.manager.plans})}};f=i([u.injectable(),r("design:paramtypes",[c.HeatingPlanRepositoryService])],f);let d=class extends l.ApiBase{constructor(e){super("GET","/plans"),this.manager=e}execute(){return o(this,void 0,void 0,function*(){return yield this.manager.plans})}};d=i([u.injectable(),r("design:paramtypes",[c.HeatingPlanRepositoryService])],d);let p=class extends l.ApiBase{constructor(e){super("GET","/plans/:id"),this.manager=e}execute(e){return o(this,void 0,void 0,function*(){return yield this.manager.find(e.params.id)})}};p=i([u.injectable(),r("design:paramtypes",[c.HeatingPlanRepositoryService])],p);let h=class extends l.ApiBase{constructor(e,t){super("PUT","/plans/:id"),this.manager=e,this.devices=t}execute(e){return o(this,void 0,void 0,function*(){const t=e.body;return t.id=e.params.id,t.devices&&s.remove(t.devices,e=>null==s.find(this.devices.devices,t=>t.id===e)),t.zones&&s.remove(t.zones,e=>null==s.find(this.devices.zones,t=>t.id===e)),yield this.manager.update(t),t})}};h=i([u.injectable(),r("design:paramtypes",[c.HeatingPlanRepositoryService,c.DeviceManagerService])],h);let g=class extends l.ApiBase{constructor(e){super("DELETE","/plans/:id"),this.manager=e}execute(e){return o(this,void 0,void 0,function*(){return yield this.manager.remove(e.params.id),l.SUCCESS})}};g=i([u.injectable(),r("design:paramtypes",[c.HeatingPlanRepositoryService])],g),t.default=[g,p,h,d,f]},61:function(e,t,n){"use strict";var i=this&&this.__decorate||function(e,t,n,i){var r,o=arguments.length,a=o<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var c=e.length-1;c>=0;c--)(r=e[c])&&(a=(o<3?r(a):o>3?r(t,n,a):r(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a},r=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},o=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(r,o){function a(e){try{s(i.next(e))}catch(e){o(e)}}function c(e){try{s(i.throw(e))}catch(e){o(e)}}function s(e){e.done?r(e.value):new n(function(t){t(e.value)}).then(a,c)}s((i=i.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});const a=n(1),c=n(0),s=n(9);let u=class extends s.ApiBase{constructor(e,t){super("GET","/schedule"),this.manager=e,this.scheduler=t}execute(){return o(this,void 0,void 0,function*(){return{mode:this.manager.operationMode,nextDate:this.scheduler.nextSchedule,temperatures:yield this.manager.evaluateActivePlans()}})}};u=i([c.injectable(),r("design:paramtypes",[a.HeatingManagerService,a.HeatingSchedulerService])],u),t.default=[u]},62:function(e,t,n){"use strict";var i=this&&this.__decorate||function(e,t,n,i){var r,o=arguments.length,a=o<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var c=e.length-1;c>=0;c--)(r=e[c])&&(a=(o<3?r(a):o>3?r(t,n,a):r(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a},r=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},o=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(r,o){function a(e){try{s(i.next(e))}catch(e){o(e)}}function c(e){try{s(i.throw(e))}catch(e){o(e)}}function s(e){e.done?r(e.value):new n(function(t){t(e.value)}).then(a,c)}s((i=i.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});const a=n(1),c=n(2),s=n(0),u=n(9);let l=class extends u.ApiBase{constructor(e){super("GET","/settings"),this.manager=e}execute(){return o(this,void 0,void 0,function*(){const e={};return c.forEach(Object.keys(a.Settings),t=>{e[t]=this.manager.get(a.Settings[t])}),e})}};l=i([s.injectable(),r("design:paramtypes",[a.SettingsManagerService])],l);let f=class extends u.ApiBase{constructor(e){super("PUT","/settings"),this.manager=e}execute(e){return o(this,void 0,void 0,function*(){const t=e.body;return c.forEach(Object.keys(a.Settings),e=>{const n=a.Settings[e];t.hasOwnProperty(e)&&this.manager.set(n,t[e])}),c.forEach(Object.keys(a.InternalSettings),e=>{const n=a.InternalSettings[e];t.hasOwnProperty(e)&&this.manager.set(n,t[e])}),u.SUCCESS})}};f=i([s.injectable(),r("design:paramtypes",[a.SettingsManagerService])],f),t.default=[l,f]},63:function(e,t,n){"use strict";var i=this&&this.__decorate||function(e,t,n,i){var r,o=arguments.length,a=o<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var c=e.length-1;c>=0;c--)(r=e[c])&&(a=(o<3?r(a):o>3?r(t,n,a):r(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a},r=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},o=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(r,o){function a(e){try{s(i.next(e))}catch(e){o(e)}}function c(e){try{s(i.throw(e))}catch(e){o(e)}}function s(e){e.done?r(e.value):new n(function(t){t(e.value)}).then(a,c)}s((i=i.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});const a=n(1),c=n(2),s=n(0),u=n(9);let l=class extends u.ApiBase{constructor(e){super("GET","/zones"),this.manager=e}execute(){return o(this,void 0,void 0,function*(){return c.map(this.manager.zones,e=>({id:e.id,name:e.name,icon:e.icon}))})}};l=i([s.injectable(),r("design:paramtypes",[a.DeviceManagerService])],l);let f=class extends u.ApiBase{constructor(e){super("GET","/devices"),this.manager=e}execute(){return o(this,void 0,void 0,function*(){return c.map(this.manager.devices,e=>({id:e.id,name:e.name,icon:e.iconObj&&e.iconObj.url}))})}};f=i([s.injectable(),r("design:paramtypes",[a.DeviceManagerService])],f),t.default=[f,l]},9:function(e,t,n){"use strict";var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(r,o){function a(e){try{s(i.next(e))}catch(e){o(e)}}function c(e){try{s(i.throw(e))}catch(e){o(e)}}function s(e){e.done?r(e.value):new n(function(t){t(e.value)}).then(a,c)}s((i=i.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});const r=n(1),o=n(0);t.SUCCESS="OK";class a{constructor(e,t){this.public=!1,a.initialize(),this.method=e,this.path=t,this.logger.information(`Bound endpoint ${e} ${t}`)}get logger(){return a.logger}static initialize(){if(a.initialized)return;const e=o.container.resolve(r.SettingsManagerService);e.onChanged.subscribe((e,t)=>{t.setting===r.InternalSettings.LogApi&&(a.logApi=t.value)}),a.logApi=e.get(r.InternalSettings.LogApi,!1),a.logger=o.container.resolve(r.LoggerFactory).createLogger("Api"),a.initialized=!0}fn(e,t){return i(this,void 0,void 0,function*(){try{a.logApi?this.logger.debug(`${this.method} ${this.path} ${JSON.stringify(e)}`):this.logger.debug(`${this.method} ${this.path}`);const n=yield this.execute(e);a.logApi&&this.logger.debug(`${this.method} ${this.path}`,"Request:",JSON.stringify(e),"Response:",JSON.stringify(n)),t(null,n)}catch(n){this.logger.error(`${this.method} ${this.path} failed`,n,e),t(n,null)}})}}a.logger=null,a.logApi=!1,a.initialized=!1,t.ApiBase=a}});
//# sourceMappingURL=api.js.map