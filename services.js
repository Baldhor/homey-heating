module.exports=function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(r,o,function(t){return e[t]}.bind(null,o));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=71)}([function(e,t){e.exports=require("./tsyringe")},,function(e,t){e.exports=require("lodash")},function(e,t,n){"use strict";function r(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}Object.defineProperty(t,"__esModule",{value:!0}),r(n(22)),r(n(120)),r(n(121))},function(e,t){e.exports=require("util")},function(e,t){e.exports=require("homey")},function(e,t){e.exports=require("./helper")},function(e,t){function n(e){if(e)return function(e){for(var t in n.prototype)e[t]=n.prototype[t];return e}(e)}e.exports=n,n.prototype.on=n.prototype.addEventListener=function(e,t){return this._callbacks=this._callbacks||{},(this._callbacks[e]=this._callbacks[e]||[]).push(t),this},n.prototype.once=function(e,t){var n=this;function r(){n.off(e,r),t.apply(this,arguments)}return this._callbacks=this._callbacks||{},r.fn=t,this.on(e,r),this},n.prototype.off=n.prototype.removeListener=n.prototype.removeAllListeners=n.prototype.removeEventListener=function(e,t){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var n,r=this._callbacks[e];if(!r)return this;if(1==arguments.length)return delete this._callbacks[e],this;for(var o=0;o<r.length;o++)if((n=r[o])===t||n.fn===t){r.splice(o,1);break}return this},n.prototype.emit=function(e){this._callbacks=this._callbacks||{};var t=[].slice.call(arguments,1),n=this._callbacks[e];if(n)for(var r=0,o=(n=n.slice(0)).length;r<o;++r)n[r].apply(this,t);return this},n.prototype.listeners=function(e){return this._callbacks=this._callbacks||{},this._callbacks[e]||[]},n.prototype.hasListeners=function(e){return!!this.listeners(e).length}},function(e,t,n){e.exports=n(97)},,function(e,t){e.exports=require("./model")},function(e,t,n){"use strict";function r(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}Object.defineProperty(t,"__esModule",{value:!0}),r(n(72)),r(n(73))},function(e,t,n){var r=n(35);e.exports=function(e){function t(){}t.enabled=!1;var n=i.some(function(t){return t.test(e)});if(n)return t;if(!(n=o.some(function(t){return t.test(e)})))return t;var r=s[c++%s.length];function h(t){t=l(t);var n=new Date,o=n-(a[e]||n);a[e]=n,t="  [9"+r+"m"+e+" [3"+r+"m[90m"+t+"[3"+r+"m +"+function(e){return e>=36e5?(e/36e5).toFixed(1)+"h":e>=6e4?(e/6e4).toFixed(1)+"m":e>=1e3?(e/1e3|0)+"s":e+"ms"}(o)+"[0m",console.error.apply(this,arguments)}function p(t){t=l(t),t=(new Date).toUTCString()+" "+e+" "+t,console.error.apply(this,arguments)}return h.enabled=p.enabled=!0,u||process.env.DEBUG_COLORS?h:p};var o=[],i=[];(process.env.DEBUG||"").split(/[\s,]+/).forEach(function(e){"-"===(e=e.replace("*",".*?"))[0]?i.push(new RegExp("^"+e.substr(1)+"$")):o.push(new RegExp("^"+e+"$"))});var s=[6,2,3,4,5,1],a={},c=0,u=r.isatty(2);function l(e){return e instanceof Error?e.stack||e.message:e}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.Enforce="enforce_policy",e.CheckTemperature="check_policy",e.Throttled_Enforce="throttled_enforce_policy",e.Throttled_CheckTemperature="throttled_check_policy"}(t.PolicyType||(t.PolicyType={}))},,function(e,t,n){"use strict";
/*!
 * Strongly Typed Events for TypeScript - Core
 * https://github.com/KeesCBakker/StronlyTypedEvents/
 * http://keestalkstech.com
 *
 * Copyright Kees C. Bakker / KeesTalksTech
 * Released under the MIT license
 */Object.defineProperty(t,"__esModule",{value:!0});var r=n(74);t.DispatcherBase=r.DispatcherBase,t.DispatcherWrapper=r.DispatcherWrapper,t.EventListBase=r.EventListBase;var o=n(33);t.Subscription=o.Subscription},function(e,t){e.exports=require("url")},function(e,t){e.exports=function(e,t){var n=function(){};n.prototype=t.prototype,e.prototype=new n,e.prototype.constructor=e}},function(e,t,n){var r=n(35),o=n(4);(t=e.exports=n(102)).log=function(){return console.log.apply(console,arguments)},t.formatArgs=function(){var e=arguments,n=this.useColors,r=this.namespace;if(n){var o=this.color;e[0]="  [9"+o+"m"+r+" [0m"+e[0]+"[3"+o+"m +"+t.humanize(this.diff)+"[0m"}else e[0]=(new Date).toUTCString()+" "+r+" "+e[0];return e},t.save=function(e){null==e?delete process.env.DEBUG:process.env.DEBUG=e},t.load=s,t.useColors=function(){var e=(process.env.DEBUG_COLORS||"").trim().toLowerCase();return 0===e.length?r.isatty(1):"0"!==e&&"no"!==e&&"false"!==e&&"disabled"!==e},t.colors=[6,2,3,4,5,1];var i=4===o.inspect.length?function(e,t){return o.inspect(e,void 0,void 0,t)}:function(e,t){return o.inspect(e,{colors:t})};function s(){return process.env.DEBUG}t.formatters.o=function(e){return i(e,this.useColors).replace(/\s*\n\s*/g," ")},t.enable(s())},function(e,t){e.exports=require("events")},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}(n(129))},,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(2),o=n(0),i=n(11),s=n(82),a=n(83),c=n(84);class u{constructor(){this.loggers=[new a.ConsoleLogger]}static get defaultLog(){return u.instance}static setupForTest(){u.instance.loggers=[]}static init(e){o.container.resolve(i.SettingsManagerService).onChanged.subscribe((t,n)=>{n.setting!==i.Settings.LogEnabled&&n.setting!==i.Settings.LogCategory||(u.instance.information("Reload due to settings change."),u.instance.evaluateLogger(e))}),u.instance.evaluateLogger(e)}information(...e){this.loggers.forEach(t=>{t.debug(...e)})}debug(...e){this.loggers.forEach(t=>{t.debug(...e)})}error(...e){this.loggers.forEach(t=>{t.error(...e)})}evaluateLogger(e){const t=[],n=o.container.resolve(i.SettingsManagerService),u=n.get(i.Settings.LogCategory),l=n.get(i.Settings.LogEnabled,!1);!r.isEmpty(u)&&l?t.push(new c.ConsoleReLogger(u)):null!=e?t.push(new s.AppLogger(e)):t.push(new a.ConsoleLogger),this.loggers=t}}u.instance=new u,t.LogService=u},function(e,t,n){var r=n(12)("socket.io-parser"),o=n(89),i=(n(24),n(7)),s=n(91),a=n(36);function c(){}function u(e){var n="",i=!1;return n+=e.type,t.BINARY_EVENT!=e.type&&t.BINARY_ACK!=e.type||(n+=e.attachments,n+="-"),e.nsp&&"/"!=e.nsp&&(i=!0,n+=e.nsp),null!=e.id&&(i&&(n+=",",i=!1),n+=e.id),null!=e.data&&(i&&(n+=","),n+=o.stringify(e.data)),r("encoded %j as %s",e,n),n}function l(){this.reconstructor=null}function h(e){this.reconPack=e,this.buffers=[]}function p(e){return{type:t.ERROR,data:"parser error"}}t.protocol=4,t.types=["CONNECT","DISCONNECT","EVENT","BINARY_EVENT","ACK","BINARY_ACK","ERROR"],t.CONNECT=0,t.DISCONNECT=1,t.EVENT=2,t.ACK=3,t.ERROR=4,t.BINARY_EVENT=5,t.BINARY_ACK=6,t.Encoder=c,t.Decoder=l,c.prototype.encode=function(e,n){(r("encoding packet %j",e),t.BINARY_EVENT==e.type||t.BINARY_ACK==e.type)?function(e,t){s.removeBlobs(e,function(e){var n=s.deconstructPacket(e),r=u(n.packet),o=n.buffers;o.unshift(r),t(o)})}(e,n):n([u(e)])},i(l.prototype),l.prototype.add=function(e){var n;if("string"==typeof e)n=function(e){var n={},i=0;if(n.type=Number(e.charAt(0)),null==t.types[n.type])return p();if(t.BINARY_EVENT==n.type||t.BINARY_ACK==n.type){for(n.attachments="";"-"!=e.charAt(++i);)n.attachments+=e.charAt(i);n.attachments=Number(n.attachments)}if("/"==e.charAt(i+1))for(n.nsp="";++i;){var s=e.charAt(i);if(","==s)break;if(n.nsp+=s,i+1==e.length)break}else n.nsp="/";var a=e.charAt(i+1);if(""!=a&&Number(a)==a){for(n.id="";++i;){var s=e.charAt(i);if(null==s||Number(s)!=s){--i;break}if(n.id+=e.charAt(i),i+1==e.length)break}n.id=Number(n.id)}if(e.charAt(++i))try{n.data=o.parse(e.substr(i))}catch(e){return p()}return r("decoded %s as %j",e,n),n}(e),t.BINARY_EVENT==n.type||t.BINARY_ACK==n.type?(this.reconstructor=new h(n),0==this.reconstructor.reconPack.attachments&&this.emit("decoded",n)):this.emit("decoded",n);else{if(!a(e)&&!e.base64)throw new Error("Unknown type: "+e);if(!this.reconstructor)throw new Error("got binary data when not reconstructing a packet");(n=this.reconstructor.takeBinaryData(e))&&(this.reconstructor=null,this.emit("decoded",n))}},l.prototype.destroy=function(){this.reconstructor&&this.reconstructor.finishedReconstruction()},h.prototype.takeBinaryData=function(e){if(this.buffers.push(e),this.buffers.length==this.reconPack.attachments){var t=s.reconstructPacket(this.reconPack,this.buffers);return this.finishedReconstruction(),t}return null},h.prototype.finishedReconstruction=function(){this.reconPack=null,this.buffers=[]}},function(e,t){e.exports=Array.isArray||function(e){return"[object Array]"==Object.prototype.toString.call(e)}},function(e,t,n){
/**
 * Wrapper for built-in http.js to emulate the browser XMLHttpRequest object.
 *
 * This can be used with JS designed for browsers to improve reuse of code and
 * allow the use of existing libraries.
 *
 * Usage: include("XMLHttpRequest.js") and use XMLHttpRequest per W3C specs.
 *
 * @author Dan DeFelippi <dan@driverdan.com>
 * @contributor David Ellis <d.f.ellis@ieee.org>
 * @license MIT
 */
var r=n(26),o=n(16),i=n(95).spawn;function s(e){var t,s,a=this,c=n(27),u=n(39),l={},h=!1,p={"User-Agent":"node-XMLHttpRequest",Accept:"*/*"},f=p,d=["accept-charset","accept-encoding","access-control-request-headers","access-control-request-method","connection","content-length","content-transfer-encoding","cookie","cookie2","date","expect","host","keep-alive","origin","referer","te","trailer","transfer-encoding","upgrade","via"],g=["TRACE","TRACK","CONNECT"],y=!1,v=!1,m={};this.UNSENT=0,this.OPENED=1,this.HEADERS_RECEIVED=2,this.LOADING=3,this.DONE=4,this.readyState=this.UNSENT,this.onreadystatechange=null,this.responseText="",this.responseXML="",this.status=null,this.statusText=null;this.open=function(e,t,n,r,o){if(this.abort(),v=!1,!function(e){return e&&-1===g.indexOf(e)}(e))throw"SecurityError: Request method not allowed";l={method:e,url:t.toString(),async:"boolean"!=typeof n||n,user:r||null,password:o||null},b(this.OPENED)},this.setDisableHeaderCheck=function(e){h=e},this.setRequestHeader=function(e,t){if(this.readyState!=this.OPENED)throw"INVALID_STATE_ERR: setRequestHeader can only be called when state is OPEN";if(function(e){return h||e&&-1===d.indexOf(e.toLowerCase())}(e)){if(y)throw"INVALID_STATE_ERR: send flag is true";f[e]=t}else console.warn('Refused to set unsafe header "'+e+'"')},this.getResponseHeader=function(e){return"string"==typeof e&&this.readyState>this.OPENED&&s.headers[e.toLowerCase()]&&!v?s.headers[e.toLowerCase()]:null},this.getAllResponseHeaders=function(){if(this.readyState<this.HEADERS_RECEIVED||v)return"";var e="";for(var t in s.headers)"set-cookie"!==t&&"set-cookie2"!==t&&(e+=t+": "+s.headers[t]+"\r\n");return e.substr(0,e.length-2)},this.getRequestHeader=function(e){return"string"==typeof e&&f[e]?f[e]:""},this.send=function(n){if(this.readyState!=this.OPENED)throw"INVALID_STATE_ERR: connection must be opened before send() is called";if(y)throw"INVALID_STATE_ERR: send has already been called";var h,p=!1,d=!1,g=o.parse(l.url);switch(g.protocol){case"https:":p=!0;case"http:":h=g.hostname;break;case"file:":d=!0;break;case void 0:case"":h="localhost";break;default:throw"Protocol not supported."}if(d){if("GET"!==l.method)throw"XMLHttpRequest: Only GET method is supported";if(l.async)r.readFile(g.pathname,"utf8",function(e,t){e?a.handleError(e):(a.status=200,a.responseText=t,b(a.DONE))});else try{this.responseText=r.readFileSync(g.pathname,"utf8"),this.status=200,b(a.DONE)}catch(e){this.handleError(e)}}else{var m=g.port||(p?443:80),_=g.pathname+(g.search?g.search:"");if(f.Host=h,p&&443===m||80===m||(f.Host+=":"+g.port),l.user){void 0===l.password&&(l.password="");var w=new Buffer(l.user+":"+l.password);f.Authorization="Basic "+w.toString("base64")}"GET"===l.method||"HEAD"===l.method?n=null:n?(f["Content-Length"]=Buffer.isBuffer(n)?n.length:Buffer.byteLength(n),f["Content-Type"]||(f["Content-Type"]="text/plain;charset=UTF-8")):"POST"===l.method&&(f["Content-Length"]=0);var E=!1;e&&e.agent&&(E=e.agent);var S={host:h,port:m,path:_,method:l.method,headers:f,agent:E};if(v=!1,l.async){var k=p?u.request:c.request;function T(e){a.handleError(e)}y=!0,a.dispatchEvent("readystatechange"),t=k(S,function e(n){if(302!==(s=n).statusCode&&303!==s.statusCode&&307!==s.statusCode)s.setEncoding("utf8"),b(a.HEADERS_RECEIVED),a.status=s.statusCode,s.on("data",function(e){e&&(a.responseText+=e),y&&b(a.LOADING)}),s.on("end",function(){y&&(b(a.DONE),y=!1)}),s.on("error",function(e){a.handleError(e)});else{l.url=s.headers.location;var r=o.parse(l.url);h=r.hostname;var i={hostname:r.hostname,port:r.port,path:r.path,method:303===s.statusCode?"GET":l.method,headers:f};(t=k(i,e).on("error",T)).end()}}).on("error",T),n&&t.write(n),t.end(),a.dispatchEvent("loadstart")}else{var O=".node-xmlhttprequest-content-"+process.pid,x=".node-xmlhttprequest-sync-"+process.pid;r.writeFileSync(x,"","utf8");for(var P="var http = require('http'), https = require('https'), fs = require('fs');var doRequest = http"+(p?"s":"")+".request;var options = "+JSON.stringify(S)+";var responseText = '';var req = doRequest(options, function(response) {response.setEncoding('utf8');response.on('data', function(chunk) {  responseText += chunk;});response.on('end', function() {fs.writeFileSync('"+O+"', 'NODE-XMLHTTPREQUEST-STATUS:' + response.statusCode + ',' + responseText, 'utf8');fs.unlinkSync('"+x+"');});response.on('error', function(error) {fs.writeFileSync('"+O+"', 'NODE-XMLHTTPREQUEST-ERROR:' + JSON.stringify(error), 'utf8');fs.unlinkSync('"+x+"');});}).on('error', function(error) {fs.writeFileSync('"+O+"', 'NODE-XMLHTTPREQUEST-ERROR:' + JSON.stringify(error), 'utf8');fs.unlinkSync('"+x+"');});"+(n?"req.write('"+n.replace(/'/g,"\\'")+"');":"")+"req.end();",C=i(process.argv[0],["-e",P]);r.existsSync(x););if(a.responseText=r.readFileSync(O,"utf8"),C.stdin.end(),r.unlinkSync(O),a.responseText.match(/^NODE-XMLHTTPREQUEST-ERROR:/)){var D=a.responseText.replace(/^NODE-XMLHTTPREQUEST-ERROR:/,"");a.handleError(D)}else a.status=a.responseText.replace(/^NODE-XMLHTTPREQUEST-STATUS:([0-9]*),.*/,"$1"),a.responseText=a.responseText.replace(/^NODE-XMLHTTPREQUEST-STATUS:[0-9]*,(.*)/,"$1"),b(a.DONE)}}},this.handleError=function(e){this.status=503,this.statusText=e,this.responseText=e.stack,v=!0,b(this.DONE)},this.abort=function(){t&&(t.abort(),t=null),f=p,this.responseText="",this.responseXML="",v=!0,this.readyState===this.UNSENT||this.readyState===this.OPENED&&!y||this.readyState===this.DONE||(y=!1,b(this.DONE)),this.readyState=this.UNSENT},this.addEventListener=function(e,t){e in m||(m[e]=[]),m[e].push(t)},this.removeEventListener=function(e,t){e in m&&(m[e]=m[e].filter(function(e){return e!==t}))},this.dispatchEvent=function(e){if("function"==typeof a["on"+e]&&a["on"+e](),e in m)for(var t=0,n=m[e].length;t<n;t++)m[e][t].call(a)};var b=function(e){a.readyState!==e&&(a.readyState=e,(l.async||a.readyState<a.OPENED||a.readyState===a.DONE)&&a.dispatchEvent("readystatechange"),a.readyState!==a.DONE||v||(a.dispatchEvent("load"),a.dispatchEvent("loadend")))}}e.exports=s,s.XMLHttpRequest=s},function(e,t){e.exports=require("fs")},function(e,t){e.exports=require("http")},function(e,t,n){var r=n(8),o=n(7);function i(e){this.path=e.path,this.hostname=e.hostname,this.port=e.port,this.secure=e.secure,this.query=e.query,this.timestampParam=e.timestampParam,this.timestampRequests=e.timestampRequests,this.readyState="",this.agent=e.agent||!1,this.socket=e.socket,this.enablesXDR=e.enablesXDR}e.exports=i,o(i.prototype),i.timestamps=0,i.prototype.onError=function(e,t){var n=new Error(e);return n.type="TransportError",n.description=t,this.emit("error",n),this},i.prototype.open=function(){return"closed"!=this.readyState&&""!=this.readyState||(this.readyState="opening",this.doOpen()),this},i.prototype.close=function(){return"opening"!=this.readyState&&"open"!=this.readyState||(this.doClose(),this.onClose()),this},i.prototype.send=function(e){if("open"!=this.readyState)throw new Error("Transport not open");this.write(e)},i.prototype.onOpen=function(){this.readyState="open",this.writable=!0,this.emit("open")},i.prototype.onData=function(e){var t=r.decodePacket(e,this.socket.binaryType);this.onPacket(t)},i.prototype.onPacket=function(e){this.emit("packet",e)},i.prototype.onClose=function(){this.readyState="closed",this.emit("close")}},function(e,t){t.encode=function(e){var t="";for(var n in e)e.hasOwnProperty(n)&&(t.length&&(t+="&"),t+=encodeURIComponent(n)+"="+encodeURIComponent(e[n]));return t},t.decode=function(e){for(var t={},n=e.split("&"),r=0,o=n.length;r<o;r++){var i=n[r].split("=");t[decodeURIComponent(i[0])]=decodeURIComponent(i[1])}return t}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}(n(126))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}(n(132))},function(e,t,n){"use strict";
/*!
 * Strongly Typed Events for TypeScript
 * https://github.com/KeesCBakker/StronlyTypedEvents/
 * http://keestalkstech.com
 *
 * Copyright Kees C. Bakker / KeesTalksTech
 * Released under the MIT license
 */Object.defineProperty(t,"__esModule",{value:!0});var r=n(15);t.DispatcherBase=r.DispatcherBase,t.DispatcherWrapper=r.DispatcherWrapper,t.EventListBase=r.EventListBase,t.Subscription=r.Subscription;var o=n(76);t.EventDispatcher=o.EventDispatcher,t.EventHandlingBase=o.EventHandlingBase,t.EventList=o.EventList;var i=n(78);t.SimpleEventDispatcher=i.SimpleEventDispatcher,t.SimpleEventHandlingBase=i.SimpleEventHandlingBase,t.SimpleEventList=i.SimpleEventList;var s=n(80);t.SignalDispatcher=s.SignalDispatcher,t.SignalHandlingBase=s.SignalHandlingBase,t.SignalList=s.SignalList},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){this.handler=e,this.isOnce=t,this.isExecuted=!1}return e.prototype.execute=function(e,t,n){if(!this.isOnce||!this.isExecuted){this.isExecuted=!0;var r=this.handler;e?setTimeout(function(){r.apply(t,n)},1):r.apply(t,n)}},e}();t.Subscription=r},function(e,t,n){var r=n(88),o=n(12)("socket.io-client:url");e.exports=function(e,t){var n=e,t=t||global.location;null==e&&(e=t.protocol+"//"+t.hostname);"string"==typeof e&&("/"==e.charAt(0)&&(e="/"==e.charAt(1)?t.protocol+e:t.hostname+e),/^(https?|wss?):\/\//.test(e)||(o("protocol-less url %s",e),e=void 0!==t?t.protocol+"//"+e:"https://"+e),o("parse %s",e),n=r(e));n.port||(/^(http|ws)$/.test(n.protocol)?n.port="80":/^(http|ws)s$/.test(n.protocol)&&(n.port="443"));return n.path=n.path||"/",n.id=n.protocol+"://"+n.host+":"+n.port,n.href=n.protocol+"://"+n.host+(t&&t.port==n.port?"":":"+n.port),n}},function(e,t){e.exports=require("tty")},function(e,t){e.exports=function(e){return global.Buffer&&global.Buffer.isBuffer(e)||global.ArrayBuffer&&e instanceof ArrayBuffer}},function(e,t,n){n(34);var r=n(92),o=n(49),i=n(7),s=n(23),a=n(50),c=n(51),u=(n(119),n(12)("socket.io-client:manager")),l=n(48);function h(e,t){if(!(this instanceof h))return new h(e,t);e&&"object"==typeof e&&(t=e,e=void 0),(t=t||{}).path=t.path||"/socket.io",this.nsps={},this.subs=[],this.opts=t,this.reconnection(!1!==t.reconnection),this.reconnectionAttempts(t.reconnectionAttempts||1/0),this.reconnectionDelay(t.reconnectionDelay||1e3),this.reconnectionDelayMax(t.reconnectionDelayMax||5e3),this.timeout(null==t.timeout?2e4:t.timeout),this.readyState="closed",this.uri=e,this.connected=[],this.attempts=0,this.encoding=!1,this.packetBuffer=[],this.encoder=new s.Encoder,this.decoder=new s.Decoder,this.autoConnect=!1!==t.autoConnect,this.autoConnect&&this.open()}e.exports=h,h.prototype.emitAll=function(){for(var e in this.emit.apply(this,arguments),this.nsps)this.nsps[e].emit.apply(this.nsps[e],arguments)},i(h.prototype),h.prototype.reconnection=function(e){return arguments.length?(this._reconnection=!!e,this):this._reconnection},h.prototype.reconnectionAttempts=function(e){return arguments.length?(this._reconnectionAttempts=e,this):this._reconnectionAttempts},h.prototype.reconnectionDelay=function(e){return arguments.length?(this._reconnectionDelay=e,this):this._reconnectionDelay},h.prototype.reconnectionDelayMax=function(e){return arguments.length?(this._reconnectionDelayMax=e,this):this._reconnectionDelayMax},h.prototype.timeout=function(e){return arguments.length?(this._timeout=e,this):this._timeout},h.prototype.maybeReconnectOnOpen=function(){this.openReconnect||this.reconnecting||!this._reconnection||0!==this.attempts||(this.openReconnect=!0,this.reconnect())},h.prototype.open=h.prototype.connect=function(e){if(u("readyState %s",this.readyState),~this.readyState.indexOf("open"))return this;u("opening %s",this.uri),this.engine=r(this.uri,this.opts);var t=this.engine,n=this;this.readyState="opening",this.skipReconnect=!1;var o=a(t,"open",function(){n.onopen(),e&&e()}),i=a(t,"error",function(t){if(u("connect_error"),n.cleanup(),n.readyState="closed",n.emitAll("connect_error",t),e){var r=new Error("Connection error");r.data=t,e(r)}n.maybeReconnectOnOpen()});if(!1!==this._timeout){var s=this._timeout;u("connect attempt will timeout after %d",s);var c=setTimeout(function(){u("connect attempt timed out after %d",s),o.destroy(),t.close(),t.emit("error","timeout"),n.emitAll("connect_timeout",s)},s);this.subs.push({destroy:function(){clearTimeout(c)}})}return this.subs.push(o),this.subs.push(i),this},h.prototype.onopen=function(){u("open"),this.cleanup(),this.readyState="open",this.emit("open");var e=this.engine;this.subs.push(a(e,"data",c(this,"ondata"))),this.subs.push(a(this.decoder,"decoded",c(this,"ondecoded"))),this.subs.push(a(e,"error",c(this,"onerror"))),this.subs.push(a(e,"close",c(this,"onclose")))},h.prototype.ondata=function(e){this.decoder.add(e)},h.prototype.ondecoded=function(e){this.emit("packet",e)},h.prototype.onerror=function(e){u("error",e),this.emitAll("error",e)},h.prototype.socket=function(e){var t=this.nsps[e];if(!t){t=new o(this,e),this.nsps[e]=t;var n=this;t.on("connect",function(){~l(n.connected,t)||n.connected.push(t)})}return t},h.prototype.destroy=function(e){var t=l(this.connected,e);~t&&this.connected.splice(t,1),this.connected.length||this.close()},h.prototype.packet=function(e){u("writing packet %j",e);var t=this;t.encoding?t.packetBuffer.push(e):(t.encoding=!0,this.encoder.encode(e,function(e){for(var n=0;n<e.length;n++)t.engine.write(e[n]);t.encoding=!1,t.processPacketQueue()}))},h.prototype.processPacketQueue=function(){if(this.packetBuffer.length>0&&!this.encoding){var e=this.packetBuffer.shift();this.packet(e)}},h.prototype.cleanup=function(){for(var e;e=this.subs.shift();)e.destroy();this.packetBuffer=[],this.encoding=!1,this.decoder.destroy()},h.prototype.close=h.prototype.disconnect=function(){this.skipReconnect=!0,this.readyState="closed",this.engine&&this.engine.close()},h.prototype.onclose=function(e){u("close"),this.cleanup(),this.readyState="closed",this.emit("close",e),this._reconnection&&!this.skipReconnect&&this.reconnect()},h.prototype.reconnect=function(){if(this.reconnecting||this.skipReconnect)return this;var e=this;if(this.attempts++,this.attempts>this._reconnectionAttempts)u("reconnect failed"),this.emitAll("reconnect_failed"),this.reconnecting=!1;else{var t=this.attempts*this.reconnectionDelay();t=Math.min(t,this.reconnectionDelayMax()),u("will wait %dms before reconnect attempt",t),this.reconnecting=!0;var n=setTimeout(function(){e.skipReconnect||(u("attempting reconnect"),e.emitAll("reconnect_attempt",e.attempts),e.emitAll("reconnecting",e.attempts),e.skipReconnect||e.open(function(t){t?(u("reconnect attempt error"),e.reconnecting=!1,e.reconnect(),e.emitAll("reconnect_error",t.data)):(u("reconnect success"),e.onreconnect())}))},t);this.subs.push({destroy:function(){clearTimeout(n)}})}},h.prototype.onreconnect=function(){var e=this.attempts;this.attempts=0,this.reconnecting=!1,this.emitAll("reconnect",e)}},function(e,t,n){var r=n(25),o=n(96),i=n(104),s=n(105);t.polling=function(e){var t=!1,n=!1,s=!1!==e.jsonp;if(global.location){var a="https:"==location.protocol,c=location.port;c||(c=a?443:80),t=e.hostname!=location.hostname||c!=e.port,n=e.secure!=a}if(e.xdomain=t,e.xscheme=n,"open"in new r(e)&&!e.forceJSONP)return new o(e);if(!s)throw new Error("JSONP disabled");return new i(e)},t.websocket=s},function(e,t){e.exports=require("https")},function(e,t,n){var r=n(28),o=n(29),i=n(8),s=n(17),a=n(18)("engine.io-client:polling");e.exports=u;var c=null!=new(n(25))({xdomain:!1}).responseType;function u(e){var t=e&&e.forceBase64;c&&!t||(this.supportsBinary=!1),r.call(this,e)}s(u,r),u.prototype.name="polling",u.prototype.doOpen=function(){this.poll()},u.prototype.pause=function(e){var t=this;function n(){a("paused"),t.readyState="paused",e()}if(this.readyState="pausing",this.polling||!this.writable){var r=0;this.polling&&(a("we are currently polling - waiting to pause"),r++,this.once("pollComplete",function(){a("pre-pause polling complete"),--r||n()})),this.writable||(a("we are currently writing - waiting to pause"),r++,this.once("drain",function(){a("pre-pause writing complete"),--r||n()}))}else n()},u.prototype.poll=function(){a("polling"),this.polling=!0,this.doPoll(),this.emit("poll")},u.prototype.onData=function(e){var t=this;a("polling got data %s",e);i.decodePayload(e,this.socket.binaryType,function(e,n,r){if("opening"==t.readyState&&t.onOpen(),"close"==e.type)return t.onClose(),!1;t.onPacket(e)}),"closed"!=this.readyState&&(this.polling=!1,this.emit("pollComplete"),"open"==this.readyState?this.poll():a('ignoring poll - transport state "%s"',this.readyState))},u.prototype.doClose=function(){var e=this;function t(){a("writing close packet"),e.write([{type:"close"}])}"open"==this.readyState?(a("transport open - closing"),t()):(a("transport not open - deferring close"),this.once("open",t))},u.prototype.write=function(e){var t=this;this.writable=!1;var n=function(){t.writable=!0,t.emit("drain")};t=this;i.encodePayload(e,this.supportsBinary,function(e){t.doWrite(e,n)})},u.prototype.uri=function(){var e=this.query||{},t=this.secure?"https":"http",n="";return!1!==this.timestampRequests&&(e[this.timestampParam]=+new Date+"-"+r.timestamps++),this.supportsBinary||e.sid||(e.b64=1),e=o.encode(e),this.port&&("https"==t&&443!=this.port||"http"==t&&80!=this.port)&&(n=":"+this.port),e.length&&(e="?"+e),t+"://"+this.hostname+n+this.path+e}},function(e,t,n){
/*!
 * ws: a node.js websocket client
 * Copyright(c) 2011 Einar Otto Stangvik <einaros@gmail.com>
 * MIT Licensed
 */
var r=n(4),o=n(19),i=n(27),s=n(39),a=n(42),c=n(16),u=n(26),l=n(43),h=n(44),p=n(47),f=n(111),d=n(112),g=13,y=/^v0\.4/.test(process.version);function v(e,t,n){t&&!Array.isArray(t)&&"object"==typeof t&&(n=t,t=null),"string"==typeof t&&(t=[t]),Array.isArray(t)||(t=[]),this._socket=null,this.bytesReceived=0,this.readyState=null,this.supports={},Array.isArray(e)?function(e,t,n,r){r=new l({protocolVersion:g,protocol:null}).merge(r),this.protocol=r.value.protocol,this.protocolVersion=r.value.protocolVersion,this.supports.binary="hixie-76"!=this.protocolVersion,this.upgradeReq=e,this.readyState=v.CONNECTING,this._isServer=!0,"hixie-76"==r.value.protocolVersion?w.call(this,d,f,t,n):w.call(this,p,h,t,n)}.apply(this,e.concat(n)):function(e,t,n){if(8!=(n=new l({origin:null,protocolVersion:g,host:null,headers:null,protocol:null,agent:null,pfx:null,key:null,passphrase:null,cert:null,ca:null,ciphers:null,rejectUnauthorized:null}).merge(n)).value.protocolVersion&&13!=n.value.protocolVersion)throw new Error("unsupported protocol version");var r=c.parse(e),o="ws+unix:"===r.protocol;if(!r.host&&!o)throw new Error("invalid url");var u="wss:"===r.protocol||"https:"===r.protocol,f=u?s:i,d=r.port||(u?443:80),m=r.auth;this._isServer=!1,this.url=e,this.protocolVersion=n.value.protocolVersion,this.supports.binary="hixie-76"!=this.protocolVersion;var b=new Buffer(n.value.protocolVersion+"-"+Date.now()).toString("base64"),_=a.createHash("sha1");_.update(b+"258EAFA5-E914-47DA-95CA-C5AB0DC85B11");var E=_.digest("base64"),S=n.value.agent;!S&&y&&(y=!0,S=new f.Agent({host:r.hostname,port:d}));var O=r.hostname;r.port&&(u&&443!=d||!u&&80!=d)&&(O=O+":"+d);var x={port:d,host:r.hostname,headers:{Connection:"Upgrade",Upgrade:"websocket",Host:O,Origin:O,"Sec-WebSocket-Version":n.value.protocolVersion,"Sec-WebSocket-Key":b}};m&&(x.headers.Authorization="Basic "+new Buffer(m).toString("base64"));n.value.protocol&&(x.headers["Sec-WebSocket-Protocol"]=n.value.protocol);n.value.host&&(x.headers.Host=n.value.host);if(n.value.headers)for(var P in n.value.headers)n.value.headers.hasOwnProperty(P)&&(x.headers[P]=n.value.headers[P]);if(n.isDefinedAndNonNull("pfx")||n.isDefinedAndNonNull("key")||n.isDefinedAndNonNull("passphrase")||n.isDefinedAndNonNull("cert")||n.isDefinedAndNonNull("ca")||n.isDefinedAndNonNull("ciphers")||n.isDefinedAndNonNull("rejectUnauthorized")){if(y)throw new Error("Client side certificates are not supported on Node 0.4.x");n.isDefinedAndNonNull("pfx")&&(x.pfx=n.value.pfx),n.isDefinedAndNonNull("key")&&(x.key=n.value.key),n.isDefinedAndNonNull("passphrase")&&(x.passphrase=n.value.passphrase),n.isDefinedAndNonNull("cert")&&(x.cert=n.value.cert),n.isDefinedAndNonNull("ca")&&(x.ca=n.value.ca),n.isDefinedAndNonNull("ciphers")&&(x.ciphers=n.value.ciphers),n.isDefinedAndNonNull("rejectUnauthorized")&&(x.rejectUnauthorized=n.value.rejectUnauthorized),S||(S=new f.Agent(x))}x.path=y?(r.pathname||"/")+(r.search||""):r.path||"/";S&&(x.agent=S);o&&(x.socketPath=r.pathname);n.value.origin&&(n.value.protocolVersion<13?x.headers["Sec-WebSocket-Origin"]=n.value.origin:x.headers.Origin=n.value.origin);var C=this,D=f.request(x);(y?S:D).on("error",function(e){C.emit("error",e),k.call(this,e)}),(y?S:D).once("response",function(e){var t=new Error("unexpected server response ("+e.statusCode+")");C.emit("error",t),k.call(this,t)}),(y?S:D).once("upgrade",function(e,t,r){if(C.readyState==v.CLOSED)return C.emit("close"),T(C),void t.end();var o=e.headers["sec-websocket-accept"];if(void 0===o||o!==E)return C.emit("error","invalid server key"),T(C),void t.end();var i=e.headers["sec-websocket-protocol"],s=(n.value.protocol||"").split(/, */),a=null;if(!n.value.protocol&&i?a="server sent a subprotocol even though none requested":n.value.protocol&&!i?a="server sent no subprotocol even though requested":i&&-1===s.indexOf(i)&&(a="server responded with an invalid protocol"),a)return C.emit("error",a),T(C),void t.end();i&&(C.protocol=i),w.call(C,p,h,t,r),T(y?S:D),D=null,S=null}),D.end(),this.readyState=v.CONNECTING}.apply(this,[e,t,n])}function m(e,t,n){this.data=e,this.type=t,this.target=n}function b(e,t,n){this.wasClean=void 0===e||1e3==e,this.code=e,this.reason=t,this.target=n}function _(e){this.target=e}function w(e,t,n,r){this._socket=n,n.setTimeout(0),n.setNoDelay(!0);var o=this;function i(e){if(o.readyState==v.OPEN){if(r&&r.length>0){o.bytesReceived+=r.length;var t=r;r=null,o._receiver.add(t)}a=s,e&&(o.bytesReceived+=e.length,o._receiver.add(e))}}function s(e){e&&(o.bytesReceived+=e.length),o._receiver.add(e)}this._receiver=new e,n.on("end",k.bind(this)),n.on("close",k.bind(this)),n.on("error",k.bind(this));var a=i;process.nextTick(i),o._receiver.ontext=function(e,t){t=t||{},o.emit("message",e,t)},o._receiver.onbinary=function(e,t){(t=t||{}).binary=!0,o.emit("message",e,t)},o._receiver.onping=function(e,t){t=t||{},o.pong(e,{mask:!o._isServer,binary:!0===t.binary},!0),o.emit("ping",e,t)},o._receiver.onpong=function(e,t){o.emit("pong",e,t)},o._receiver.onclose=function(e,t,n){n=n||{},o.close(e,t)},o._receiver.onerror=function(e,t){o.close(void 0!==t?t:1002,""),o.emit("error",e,t)},this._sender=new t(n),this._sender.on("error",function(e){o.close(1002,""),o.emit("error",e)}),this.readyState=v.OPEN,this.emit("open"),n.on("data",a)}function E(e){e._queue=e._queue||[]}function S(e){var t=e._queue;if(void 0!==t){delete e._queue;for(var n=0,r=t.length;n<r;++n)t[n]()}}function k(e){if(this.readyState!=v.CLOSED){var t=this.readyState!=v.CONNECTING;if(this.readyState=v.CLOSED,clearTimeout(this._closeTimer),this._closeTimer=null,t&&this.emit("close",this._closeCode||1e3,this._closeMessage||""),this._socket){T(this._socket);var n=this._socket;this._socket.on("error",function(){try{n.destroy()}catch(e){}});try{e?this._socket.destroy():this._socket.end()}catch(e){}this._socket=null}this._sender&&(T(this._sender),this._sender=null),this._receiver&&(this._receiver.cleanup(),this._receiver=null),T(this),this.on("error",function(){}),delete this._queue}}function T(e){y?e._events={}:e.removeAllListeners()}r.inherits(v,o.EventEmitter),["CONNECTING","OPEN","CLOSING","CLOSED"].forEach(function(e,t){v.prototype[e]=v[e]=t}),v.prototype.close=function(e,t){if(this.readyState!=v.CLOSING&&this.readyState!=v.CLOSED)if(this.readyState!=v.CONNECTING)try{this.readyState=v.CLOSING,this._closeCode=e,this._closeMessage=t;var n=!this._isServer;this._sender.close(e,t,n)}catch(e){this.emit("error",e)}finally{this.terminate()}else this.readyState=v.CLOSED},v.prototype.pause=function(){if(this.readyState!=v.OPEN)throw new Error("not opened");return this._socket.pause()},v.prototype.ping=function(e,t,n){if(this.readyState!=v.OPEN){if(!0===n)return;throw new Error("not opened")}void 0===(t=t||{}).mask&&(t.mask=!this._isServer),this._sender.ping(e,t)},v.prototype.pong=function(e,t,n){if(this.readyState!=v.OPEN){if(!0===n)return;throw new Error("not opened")}void 0===(t=t||{}).mask&&(t.mask=!this._isServer),this._sender.pong(e,t)},v.prototype.resume=function(){if(this.readyState!=v.OPEN)throw new Error("not opened");return this._socket.resume()},v.prototype.send=function(e,t,n){if("function"==typeof t&&(n=t,t={}),this.readyState==v.OPEN)if(e||(e=""),this._queue){var r=this;this._queue.push(function(){r.send(e,t,n)})}else if((t=t||{}).fin=!0,void 0===t.binary&&(t.binary=e instanceof ArrayBuffer||e instanceof Buffer||e instanceof Uint8Array||e instanceof Uint16Array||e instanceof Uint32Array||e instanceof Int8Array||e instanceof Int16Array||e instanceof Int32Array||e instanceof Float32Array||e instanceof Float64Array),void 0===t.mask&&(t.mask=!this._isServer),e instanceof u.ReadStream){E(this);r=this;!function(e,t,n,r){t.on("data",function(t){e.readyState==v.OPEN?(n.fin=!1,e._sender.send(t,n)):"function"==typeof r?r(new Error("not opened")):(delete e._queue,e.emit("error",new Error("not opened")))}),t.on("end",function(){e.readyState==v.OPEN?(n.fin=!0,e._sender.send(null,n),"function"==typeof r&&r(null)):"function"==typeof r?r(new Error("not opened")):(delete e._queue,e.emit("error",new Error("not opened")))})}(this,e,t,function(e){process.nextTick(function(){S(r)}),"function"==typeof n&&n(e)})}else this._sender.send(e,t,n);else{if("function"!=typeof n)throw new Error("not opened");n(new Error("not opened"))}},v.prototype.stream=function(e,t){"function"==typeof e&&(t=e,e={});var n=this;if("function"!=typeof t)throw new Error("callback must be provided");if(this.readyState==v.OPEN)if(this._queue)this._queue.push(function(){n.stream(e,t)});else{void 0===(e=e||{}).mask&&(e.mask=!this._isServer),E(this);var r=function(o,i){try{if(n.readyState!=v.OPEN)throw new Error("not opened");e.fin=!0===i,n._sender.send(o,e),i?S(n):process.nextTick(t.bind(null,null,r))}catch(e){"function"==typeof t?t(e):(delete n._queue,n.emit("error",e))}};process.nextTick(t.bind(null,null,r))}else{if("function"!=typeof t)throw new Error("not opened");t(new Error("not opened"))}},v.prototype.terminate=function(){if(this.readyState!=v.CLOSED)if(this._socket){try{this._socket.end()}catch(e){return void k.call(this,!0)}this._closeTimer=setTimeout(k.bind(this,!0),3e4)}else this.readyState==v.CONNECTING&&k.call(this,!0)},Object.defineProperty(v.prototype,"bufferedAmount",{get:function(){var e=0;return this._socket&&(e=this._socket.bufferSize||0),e}}),["open","error","close","message"].forEach(function(e){Object.defineProperty(v.prototype,"on"+e,{get:function(){var t=this.listeners(e)[0];return t?t._listener?t._listener:t:void 0},set:function(t){this.removeAllListeners(e),this.addEventListener(e,t)}})}),v.prototype.addEventListener=function(e,t){var n=this;if("function"==typeof t)if("message"===e){function r(e,r){t.call(this,new m(e,r.binary?"Binary":"Text",n))}r._listener=t,this.on(e,r)}else if("close"===e){function o(e,r){t.call(this,new b(e,r,n))}o._listener=t,this.on(e,o)}else if("error"===e){function i(e){e.target=n,t.call(this,e)}i._listener=t,this.on(e,i)}else if("open"===e){function s(){t.call(this,new _(n))}s._listener=t,this.on(e,s)}else this.on(e,t)},e.exports=v},function(e,t){e.exports=require("crypto")},function(e,t,n){
/*!
 * Copyright(c) 2011 Einar Otto Stangvik <einaros@gmail.com>
 * MIT Licensed
 */
var r=n(26);e.exports=function(e){var t={},n=this.value={};Object.keys(e).forEach(function(r){t[r]=e[r],Object.defineProperty(n,r,{get:function(){return t[r]},configurable:!1,enumerable:!0})}),this.reset=function(){return Object.keys(e).forEach(function(n){t[n]=e[n]}),this},this.merge=function(e,n){if(e=e||{},"[object Array]"===Object.prototype.toString.call(n)){for(var r=[],o=0,i=n.length;o<i;++o){var s=n[o];s in e||r.push(s)}if(r.length>0)throw r.length>1?new Error("options "+r.slice(0,r.length-1).join(", ")+" and "+r[r.length-1]+" must be defined"):new Error("option "+r[0]+" must be defined")}return Object.keys(e).forEach(function(n){n in t&&(t[n]=e[n])}),this},this.copy=function(t){var r={};return Object.keys(e).forEach(function(e){-1!==t.indexOf(e)&&(r[e]=n[e])}),r},this.read=function(e,t){if("function"==typeof t){var n=this;r.readFile(e,function(e,r){if(e)return t(e);var o=JSON.parse(r);n.merge(o),t()})}else{var o=JSON.parse(r.readFileSync(e));this.merge(o)}return this},this.isDefined=function(e){return void 0!==n[e]},this.isDefinedAndNonNull=function(e){return null!=n[e]},Object.freeze(n),Object.freeze(this)}},function(e,t,n){
/*!
 * ws: a node.js websocket client
 * Copyright(c) 2011 Einar Otto Stangvik <einaros@gmail.com>
 * MIT Licensed
 */
var r=n(19),o=n(4),i=(r.EventEmitter,n(45)),s=n(46).BufferUtil;function a(e){this._socket=e,this.firstFragment=!0}function c(e,t){this[t]=(65280&e)>>8,this[t+1]=255&e}function u(e,t){this[t]=(4278190080&e)>>24,this[t+1]=(16711680&e)>>16,this[t+2]=(65280&e)>>8,this[t+3]=255&e}o.inherits(a,r.EventEmitter),a.prototype.close=function(e,t,n){if(void 0!==e&&("number"!=typeof e||!i.isValidErrorCode(e)))throw new Error("first argument must be a valid error code number");e=e||1e3;var r=new Buffer(2+(t?Buffer.byteLength(t):0));c.call(r,e,0),r.length>2&&r.write(t,2),this.frameAndSend(8,r,!0,n)},a.prototype.ping=function(e,t){var n=t&&t.mask;this.frameAndSend(9,e||"",!0,n)},a.prototype.pong=function(e,t){var n=t&&t.mask;this.frameAndSend(10,e||"",!0,n)},a.prototype.send=function(e,t,n){var r=!t||!1!==t.fin,o=t&&t.mask,i=t&&t.binary?2:1;!1===this.firstFragment?i=0:this.firstFragment=!1,r&&(this.firstFragment=!0),this.frameAndSend(i,e,r,o,n)},a.prototype.frameAndSend=function(e,t,n,r,o){var i=!1;if(t){Buffer.isBuffer(t)||(i=!0,t=!t||void 0===t.byteLength&&void 0===t.buffer?new Buffer(t):function(e){for(var t=new Uint8Array(e.buffer||e),n=e.byteLength||e.length,r=e.byteOffset||0,o=new Buffer(n),i=0;i<n;++i)o[i]=t[r+i];return o}(t));var a=t.length,l=r?6:2,h=a;a>=65536?(l+=8,h=127):a>125&&(l+=2,h=126);var p=a<32768||r&&!i,f=new Buffer(p?a+l:l);switch(f[0]=n?128|e:e,h){case 126:c.call(f,a,2);break;case 127:u.call(f,0,2),u.call(f,a,6)}if(r){f[1]=128|h;var d=this._randomMask||(this._randomMask=new Buffer([~~(255*Math.random()),~~(255*Math.random()),~~(255*Math.random()),~~(255*Math.random())]));if(f[l-4]=d[0],f[l-3]=d[1],f[l-2]=d[2],f[l-1]=d[3],p){s.mask(t,d,f,l,a);try{this._socket.write(f,"binary",o)}catch(e){"function"==typeof o?o(e):this.emit("error",e)}}else{s.mask(t,d,t,0,a);try{this._socket.write(f,"binary"),this._socket.write(t,"binary",o)}catch(e){"function"==typeof o?o(e):this.emit("error",e)}}}else if(f[1]=h,p){t.copy(f,l);try{this._socket.write(f,"binary",o)}catch(e){"function"==typeof o?o(e):this.emit("error",e)}}else try{this._socket.write(f,"binary"),this._socket.write(t,"binary",o)}catch(e){"function"==typeof o?o(e):this.emit("error",e)}}else try{this._socket.write(new Buffer([e|(n?128:0),0|(r?128:0)].concat(r?[0,0,0,0]:[])),"binary",o)}catch(e){"function"==typeof o?o(e):this.emit("error",e)}},e.exports=a},function(e,t){
/*!
 * ws: a node.js websocket client
 * Copyright(c) 2011 Einar Otto Stangvik <einaros@gmail.com>
 * MIT Licensed
 */
e.exports={isValidErrorCode:function(e){return e>=1e3&&e<=1011&&1004!=e&&1005!=e&&1006!=e||e>=3e3&&e<=4999},1000:"normal",1001:"going away",1002:"protocol error",1003:"unsupported data",1004:"reserved",1005:"reserved for extensions",1006:"reserved for extensions",1007:"inconsistent or invalid data",1008:"policy violation",1009:"message too big",1010:"extension handshake missing",1011:"an unexpected condition prevented the request from being fulfilled"}},function(e,t,n){
/*!
 * ws: a node.js websocket client
 * Copyright(c) 2011 Einar Otto Stangvik <einaros@gmail.com>
 * MIT Licensed
 */
try{e.exports=n(!function(){var e=new Error("Cannot find module '../build/Release/bufferutil'");throw e.code="MODULE_NOT_FOUND",e}())}catch(t){try{e.exports=n(!function(){var e=new Error("Cannot find module '../build/default/bufferutil'");throw e.code="MODULE_NOT_FOUND",e}())}catch(t){try{e.exports=n(107)}catch(e){throw console.error("bufferutil.node seems to not have been built. Run npm install."),e}}}},function(e,t,n){
/*!
 * ws: a node.js websocket client
 * Copyright(c) 2011 Einar Otto Stangvik <einaros@gmail.com>
 * MIT Licensed
 */
n(4);var r=n(108).Validation,o=n(45),i=n(110),s=n(46).BufferUtil,a=/^v0\.4/.test(process.version);function c(){var e=-1;this.fragmentedBufferPool=new i(1024,function(e,t){return e.used+t},function(t){return e=e>=0?(e+t.used)/2:t.used});var t=-1;this.unfragmentedBufferPool=new i(1024,function(e,t){return e.used+t},function(e){return t=t>=0?(t+e.used)/2:e.used}),this.state={activeFragmentedOperation:null,lastFragment:!1,masked:!1,opcode:0,fragmentedOperation:!1},this.overflow=[],this.headerBuffer=new Buffer(10),this.expectOffset=0,this.expectBuffer=null,this.expectHandler=null,this.currentMessage=[],this.expectHeader(2,this.processPacket),this.dead=!1,this.onerror=function(){},this.ontext=function(){},this.onbinary=function(){},this.onclose=function(){},this.onping=function(){},this.onpong=function(){}}function u(e){return(this[e]<<8)+this[e+1]}function l(e){return(this[e]<<24)+(this[e+1]<<16)+(this[e+2]<<8)+this[e+3]}function h(e,t,n,r){switch(e){default:t.copy(n,r,0,e);break;case 16:n[r+15]=t[15];case 15:n[r+14]=t[14];case 14:n[r+13]=t[13];case 13:n[r+12]=t[12];case 12:n[r+11]=t[11];case 11:n[r+10]=t[10];case 10:n[r+9]=t[9];case 9:n[r+8]=t[8];case 8:n[r+7]=t[7];case 7:n[r+6]=t[6];case 6:n[r+5]=t[5];case 5:n[r+4]=t[4];case 4:n[r+3]=t[3];case 3:n[r+2]=t[2];case 2:n[r+1]=t[1];case 1:n[r]=t[0]}}e.exports=c,c.prototype.add=function(e){var t=e.length;if(0!=t)if(null!=this.expectBuffer){var n=Math.min(t,this.expectBuffer.length-this.expectOffset);for(h(n,e,this.expectBuffer,this.expectOffset),this.expectOffset+=n,n<t&&this.overflow.push(e.slice(n));this.expectBuffer&&this.expectOffset==this.expectBuffer.length;){var r=this.expectBuffer;this.expectBuffer=null,this.expectOffset=0,this.expectHandler.call(this,r)}}else this.overflow.push(e)},c.prototype.cleanup=function(){this.dead=!0,this.overflow=null,this.headerBuffer=null,this.expectBuffer=null,this.expectHandler=null,this.unfragmentedBufferPool=null,this.fragmentedBufferPool=null,this.state=null,this.currentMessage=null,this.onerror=null,this.ontext=null,this.onbinary=null,this.onclose=null,this.onping=null,this.onpong=null},c.prototype.expectHeader=function(e,t){if(0!=e){this.expectBuffer=this.headerBuffer.slice(this.expectOffset,this.expectOffset+e),this.expectHandler=t;for(var n=e;n>0&&this.overflow.length>0;){var r=this.overflow.pop();n<r.length&&this.overflow.push(r.slice(n));var o=Math.min(r.length,n);h(o,r,this.expectBuffer,this.expectOffset),this.expectOffset+=o,n-=o}}else t(null)},c.prototype.expectData=function(e,t){if(0!=e){this.expectBuffer=this.allocateFromPool(e,this.state.fragmentedOperation),this.expectHandler=t;for(var n=e;n>0&&this.overflow.length>0;){var r=this.overflow.pop();n<r.length&&this.overflow.push(r.slice(n));var o=Math.min(r.length,n);h(o,r,this.expectBuffer,this.expectOffset),this.expectOffset+=o,n-=o}}else t(null)},c.prototype.allocateFromPool=a?function(e){return new Buffer(e)}:function(e,t){return(t?this.fragmentedBufferPool:this.unfragmentedBufferPool).get(e)},c.prototype.processPacket=function(e){if(0==(112&e[0])){this.state.lastFragment=128==(128&e[0]),this.state.masked=128==(128&e[1]);var t=15&e[0];if(0===t){if(this.state.fragmentedOperation=!0,this.state.opcode=this.state.activeFragmentedOperation,1!=this.state.opcode&&2!=this.state.opcode)return void this.error("continuation frame cannot follow current opcode",1002)}else{if(t<3&&null!=this.state.activeFragmentedOperation)return void this.error("data frames after the initial data frame must have opcode 0",1002);this.state.opcode=t,!1===this.state.lastFragment?(this.state.fragmentedOperation=!0,this.state.activeFragmentedOperation=t):this.state.fragmentedOperation=!1}var n=p[this.state.opcode];void 0===n?this.error("no handler for opcode "+this.state.opcode,1002):n.start.call(this,e)}else this.error("reserved fields must be empty",1002)},c.prototype.endPacket=function(){this.state.fragmentedOperation?this.state.lastFragment&&this.fragmentedBufferPool.reset(!1):this.unfragmentedBufferPool.reset(!0),this.expectOffset=0,this.expectBuffer=null,this.expectHandler=null,this.state.lastFragment&&this.state.opcode===this.state.activeFragmentedOperation&&(this.state.activeFragmentedOperation=null),this.state.lastFragment=!1,this.state.opcode=null!=this.state.activeFragmentedOperation?this.state.activeFragmentedOperation:0,this.state.masked=!1,this.expectHeader(2,this.processPacket)},c.prototype.reset=function(){this.dead||(this.state={activeFragmentedOperation:null,lastFragment:!1,masked:!1,opcode:0,fragmentedOperation:!1},this.fragmentedBufferPool.reset(!0),this.unfragmentedBufferPool.reset(!0),this.expectOffset=0,this.expectBuffer=null,this.expectHandler=null,this.overflow=[],this.currentMessage=[])},c.prototype.unmask=function(e,t,n){return null!=e&&null!=t&&s.unmask(t,e),n?t:null!=t?t.toString("utf8"):""},c.prototype.concatBuffers=function(e){for(var t=0,n=0,r=e.length;n<r;++n)t+=e[n].length;var o=new Buffer(t);return s.merge(o,e),o},c.prototype.error=function(e,t){return this.reset(),this.onerror(e,t),this};var p={1:{start:function(e){var t=this,n=127&e[1];n<126?p[1].getData.call(t,n):126==n?t.expectHeader(2,function(e){p[1].getData.call(t,u.call(e,0))}):127==n&&t.expectHeader(8,function(e){0==l.call(e,0)?p[1].getData.call(t,l.call(e,4)):t.error("packets with length spanning more than 32 bit is currently not supported",1008)})},getData:function(e){var t=this;t.state.masked?t.expectHeader(4,function(n){var r=n;t.expectData(e,function(e){p[1].finish.call(t,r,e)})}):t.expectData(e,function(e){p[1].finish.call(t,null,e)})},finish:function(e,t){var n=this.unmask(e,t,!0);if(null!=n&&this.currentMessage.push(n),this.state.lastFragment){var o=this.concatBuffers(this.currentMessage);if(!r.isValidUTF8(o))return void this.error("invalid utf8 sequence",1007);this.ontext(o.toString("utf8"),{masked:this.state.masked,buffer:o}),this.currentMessage=[]}this.endPacket()}},2:{start:function(e){var t=this,n=127&e[1];n<126?p[2].getData.call(t,n):126==n?t.expectHeader(2,function(e){p[2].getData.call(t,u.call(e,0))}):127==n&&t.expectHeader(8,function(e){0==l.call(e,0)?p[2].getData.call(t,l.call(e,4,!0)):t.error("packets with length spanning more than 32 bit is currently not supported",1008)})},getData:function(e){var t=this;t.state.masked?t.expectHeader(4,function(n){var r=n;t.expectData(e,function(e){p[2].finish.call(t,r,e)})}):t.expectData(e,function(e){p[2].finish.call(t,null,e)})},finish:function(e,t){var n=this.unmask(e,t,!0);if(null!=n&&this.currentMessage.push(n),this.state.lastFragment){var r=this.concatBuffers(this.currentMessage);this.onbinary(r,{masked:this.state.masked,buffer:r}),this.currentMessage=[]}this.endPacket()}},8:{start:function(e){if(0!=this.state.lastFragment){var t=127&e[1];t<126?p[8].getData.call(this,t):this.error("control frames cannot have more than 125 bytes of data",1002)}else this.error("fragmented close is not supported",1002)},getData:function(e){var t=this;t.state.masked?t.expectHeader(4,function(n){var r=n;t.expectData(e,function(e){p[8].finish.call(t,r,e)})}):t.expectData(e,function(e){p[8].finish.call(t,null,e)})},finish:function(e,t){if((t=this.unmask(e,t,!0))&&1==t.length)this.error("close packets with data must be at least two bytes long",1002);else{var n=t&&t.length>1?u.call(t,0):1e3;if(o.isValidErrorCode(n)){var i="";if(t&&t.length>2){var s=t.slice(2);if(!r.isValidUTF8(s))return void this.error("invalid utf8 sequence",1007);i=s.toString("utf8")}this.onclose(n,i,{masked:this.state.masked}),this.reset()}else this.error("invalid error code",1002)}}},9:{start:function(e){if(0!=this.state.lastFragment){var t=127&e[1];t<126?p[9].getData.call(this,t):this.error("control frames cannot have more than 125 bytes of data",1002)}else this.error("fragmented ping is not supported",1002)},getData:function(e){var t=this;t.state.masked?t.expectHeader(4,function(n){var r=n;t.expectData(e,function(e){p[9].finish.call(t,r,e)})}):t.expectData(e,function(e){p[9].finish.call(t,null,e)})},finish:function(e,t){this.onping(this.unmask(e,t,!0),{masked:this.state.masked,binary:!0}),this.endPacket()}},10:{start:function(e){if(0!=this.state.lastFragment){var t=127&e[1];t<126?p[10].getData.call(this,t):this.error("control frames cannot have more than 125 bytes of data",1002)}else this.error("fragmented pong is not supported",1002)},getData:function(e){var t=this;this.state.masked?this.expectHeader(4,function(n){var r=n;t.expectData(e,function(e){p[10].finish.call(t,r,e)})}):this.expectData(e,function(e){p[10].finish.call(t,null,e)})},finish:function(e,t){this.onpong(this.unmask(e,t,!0),{masked:this.state.masked,binary:!0}),this.endPacket()}}}},function(e,t){var n=[].indexOf;e.exports=function(e,t){if(n)return e.indexOf(t);for(var r=0;r<e.length;++r)if(e[r]===t)return r;return-1}},function(e,t,n){var r=n(23),o=n(7),i=n(117),s=n(50),a=n(51),c=n(12)("socket.io-client:socket"),u=n(118);e.exports=p;var l={connect:1,connect_error:1,connect_timeout:1,disconnect:1,error:1,reconnect:1,reconnect_attempt:1,reconnect_failed:1,reconnect_error:1,reconnecting:1},h=o.prototype.emit;function p(e,t){this.io=e,this.nsp=t,this.json=this,this.ids=0,this.acks={},this.io.autoConnect&&this.open(),this.receiveBuffer=[],this.sendBuffer=[],this.connected=!1,this.disconnected=!0}o(p.prototype),p.prototype.subEvents=function(){if(!this.subs){var e=this.io;this.subs=[s(e,"open",a(this,"onopen")),s(e,"packet",a(this,"onpacket")),s(e,"close",a(this,"onclose"))]}},p.prototype.open=p.prototype.connect=function(){return this.connected?this:(this.subEvents(),this.io.open(),"open"==this.io.readyState&&this.onopen(),this)},p.prototype.send=function(){var e=i(arguments);return e.unshift("message"),this.emit.apply(this,e),this},p.prototype.emit=function(e){if(l.hasOwnProperty(e))return h.apply(this,arguments),this;var t=i(arguments),n=r.EVENT;u(t)&&(n=r.BINARY_EVENT);var o={type:n,data:t};return"function"==typeof t[t.length-1]&&(c("emitting packet with ack id %d",this.ids),this.acks[this.ids]=t.pop(),o.id=this.ids++),this.connected?this.packet(o):this.sendBuffer.push(o),this},p.prototype.packet=function(e){e.nsp=this.nsp,this.io.packet(e)},p.prototype.onopen=function(){c("transport is open - connecting"),"/"!=this.nsp&&this.packet({type:r.CONNECT})},p.prototype.onclose=function(e){c("close (%s)",e),this.connected=!1,this.disconnected=!0,this.emit("disconnect",e)},p.prototype.onpacket=function(e){if(e.nsp==this.nsp)switch(e.type){case r.CONNECT:this.onconnect();break;case r.EVENT:case r.BINARY_EVENT:this.onevent(e);break;case r.ACK:case r.BINARY_ACK:this.onack(e);break;case r.DISCONNECT:this.ondisconnect();break;case r.ERROR:this.emit("error",e.data)}},p.prototype.onevent=function(e){var t=e.data||[];c("emitting event %j",t),null!=e.id&&(c("attaching ack callback to event"),t.push(this.ack(e.id))),this.connected?h.apply(this,t):this.receiveBuffer.push(t)},p.prototype.ack=function(e){var t=this,n=!1;return function(){if(!n){n=!0;var o=i(arguments);c("sending ack %j",o);var s=u(o)?r.BINARY_ACK:r.ACK;t.packet({type:s,id:e,data:o})}}},p.prototype.onack=function(e){c("calling ack %s with %j",e.id,e.data),this.acks[e.id].apply(this,e.data),delete this.acks[e.id]},p.prototype.onconnect=function(){this.connected=!0,this.disconnected=!1,this.emit("connect"),this.emitBuffered()},p.prototype.emitBuffered=function(){var e;for(e=0;e<this.receiveBuffer.length;e++)h.apply(this,this.receiveBuffer[e]);for(this.receiveBuffer=[],e=0;e<this.sendBuffer.length;e++)this.packet(this.sendBuffer[e]);this.sendBuffer=[]},p.prototype.ondisconnect=function(){c("server disconnect (%s)",this.nsp),this.destroy(),this.onclose("io server disconnect")},p.prototype.destroy=function(){if(this.subs){for(var e=0;e<this.subs.length;e++)this.subs[e].destroy();this.subs=null}this.io.destroy(this)},p.prototype.close=p.prototype.disconnect=function(){return this.connected&&(c("performing disconnect (%s)",this.nsp),this.packet({type:r.DISCONNECT})),this.destroy(),this.connected&&this.onclose("io client disconnect"),this}},function(e,t){e.exports=function(e,t,n){return e.on(t,n),{destroy:function(){e.removeListener(t,n)}}}},function(e,t){var n=[].slice;e.exports=function(e,t){if("string"==typeof t&&(t=e[t]),"function"!=typeof t)throw new Error("bind() requires a function");var r=n.call(arguments,2);return function(){return t.apply(e,r.concat(n.call(arguments)))}}},function(e,t,n){"use strict";function r(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}Object.defineProperty(t,"__esModule",{value:!0}),r(n(123)),r(n(124))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n(54),n(55),n(130),function(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}(n(131));var r=n(13);t.PolicyTypes=r.PolicyType},function(e,t,n){"use strict";var r,o=this&&this.__decorate||function(e,t,n,r){var o,i=arguments.length,s=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,n,s):o(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},i=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},s=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(o,i){function s(e){try{c(r.next(e))}catch(e){i(e)}}function a(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(s,a)}c((r=r.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});const a=n(6),c=n(0),u=n(20),l=n(3),h=n(13);let p=r=class{constructor(e,t){this.deviceManager=t,this.logger=e.createLogger("ST/Check")}setTargetTemperature(e,t){return s(this,void 0,void 0,function*(){if(this.logger.debug(`Checking temperature ${t}° for device ${e.name} (${e.id})`),!e.ready)return this.logger.error(`> Device ${e.name} is not ready (${e.unavailableMessage}).`),{success:!1,skipped:!0,error:"not_ready"};try{return this.deviceManager.getTargetTemperature(e)!==t?(yield a.Retry(()=>s(this,void 0,void 0,function*(){this.logger.information(`Adjusting temperature for ${e.name} to ${t}`),yield this.deviceManager.setTargetTemperature(e,t),this.logger.debug(`> ${e.name} done.`)}),this.logger,5,1e3,!0,2e4),{success:!0,skipped:!1}):(this.logger.information(`> ${e.name} target temperature already set.`),{success:!0,skipped:!0})}catch(t){return this.logger.error(`Failed to set temperature ${e.name} (${e.id})`,t),{success:!1,skipped:!1,error:t.name}}})}};o([l.asynctrycatchlog(!0,{success:!1,error:"unhandeled"}),i("design:type",Function),i("design:paramtypes",[Object,Number]),i("design:returntype",Promise)],p.prototype,"setTargetTemperature",null),p=r=o([c.injectable(),c.registry([{token:h.PolicyType.CheckTemperature,useToken:r}]),i("design:paramtypes",[l.LoggerFactory,u.DeviceManagerService])],p),t.CheckTemperaturePolicy=p},function(e,t,n){"use strict";var r,o=this&&this.__decorate||function(e,t,n,r){var o,i=arguments.length,s=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,n,s):o(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},i=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},s=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(o,i){function s(e){try{c(r.next(e))}catch(e){i(e)}}function a(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(s,a)}c((r=r.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});const a=n(6),c=n(0),u=n(20),l=n(3),h=n(13);let p=r=class{constructor(e,t){this.deviceManager=t,this.logger=e.createLogger("ST/Enforce")}setTargetTemperature(e,t){return s(this,void 0,void 0,function*(){if(this.logger.debug(`Checking temperature for device ${e.name} (${e.id})`),!e.ready)return this.logger.error(`> Device ${e.name} is not ready (${e.unavailableMessage}).`),{success:!1,skipped:!1,error:"not_ready"};try{return yield a.Retry(()=>s(this,void 0,void 0,function*(){this.logger.information(`Adjusting temperature for ${e.name} to ${t}`),yield this.deviceManager.setTargetTemperature(e,t),this.logger.debug(`> ${e.name} done.`)}),this.logger,5,1e3,!0,2e4),{success:!0,skipped:!1}}catch(t){return this.logger.error(`Failed to set temperature ${e.name} (${e.id})`,t),{success:!1,skipped:!1,error:t.name}}})}};o([l.asynctrycatchlog(!0,{success:!1,error:"unhandeled"}),i("design:type",Function),i("design:paramtypes",[Object,Number]),i("design:returntype",Promise)],p.prototype,"setTargetTemperature",null),p=r=o([c.injectable(),c.registry([{token:h.PolicyType.Enforce,useToken:r}]),i("design:paramtypes",[l.LoggerFactory,u.DeviceManagerService])],p),t.EnforceTemperaturePolicy=p},,,,,,,,,,,,,,,,function(e,t,n){"use strict";function r(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}Object.defineProperty(t,"__esModule",{value:!0}),r(n(11)),r(n(3)),r(n(52)),r(n(30)),r(n(127)),r(n(20)),r(n(31)),r(n(53))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.LogCategory="consolere",e.LogEnabled="logenabled",e.Plans="plans"}(t.Settings||(t.Settings={})),function(e){e.OperationMode="mode",e.LogApi="logapi",e.SetTemperaturePolicy="temperaturepolicy",e.SetTemperatureThrottle="temperatureThrottle"}(t.InternalSettings||(t.InternalSettings={}))},function(e,t,n){"use strict";var r,o,i=this&&this.__decorate||function(e,t,n,r){var o,i=arguments.length,s=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,n,s):o(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},s=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0});const a=n(5),c=n(32),u=n(0),l=n(3);let h=class{constructor(e){this.onChangedDispatcher=new c.EventDispatcher,this.devSettings={},this.logger=e.createLogger("Settings")}get onChanged(){return this.onChangedDispatcher.asEvent()}get(e,t=null){let n=a.ManagerSettings.get(e);return null!=n&&void 0!==n||(n=t),this.logger.debug(`Get '${e}' => '${n}'`),n}set(e,t){this.logger.debug(`Put '${e}' <= '${t}'`);try{null==t?a.ManagerSettings.unset(e):a.ManagerSettings.set(e,t)}finally{this.onChangedDispatcher.dispatch(this,{setting:e,value:t})}}};i([l.trycatchlog(),s("design:type",Function),s("design:paramtypes",[String,"function"==typeof(r="undefined"!=typeof T&&T)?r:Object]),s("design:returntype",void 0)],h.prototype,"get",null),i([l.trycatchlog(),s("design:type",Function),s("design:paramtypes",[String,"function"==typeof(o="undefined"!=typeof T&&T)?o:Object]),s("design:returntype",void 0)],h.prototype,"set",null),h=i([u.singleton(),s("design:paramtypes",[l.LoggerFactory])],h),t.SettingsManagerService=h},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(75),o=n(33),i=function(){function e(){this._wrap=new a(this),this._subscriptions=new Array}return e.prototype.subscribe=function(e){var t=this;return e&&this._subscriptions.push(new o.Subscription(e,!1)),function(){t.unsubscribe(e)}},e.prototype.sub=function(e){return this.subscribe(e)},e.prototype.one=function(e){var t=this;return e&&this._subscriptions.push(new o.Subscription(e,!0)),function(){t.unsubscribe(e)}},e.prototype.has=function(e){return!!e&&this._subscriptions.some(function(t){return t.handler==e})},e.prototype.unsubscribe=function(e){if(e)for(var t=0;t<this._subscriptions.length;t++)if(this._subscriptions[t].handler==e){this._subscriptions.splice(t,1);break}},e.prototype.unsub=function(e){this.unsubscribe(e)},e.prototype._dispatch=function(e,t,n){for(var o=this,i=function(i){var a=new r.EventManagement(function(){return o.unsub(i.handler)}),c=Array.prototype.slice.call(n);if(c.push(a),i.execute(e,t,c),s.cleanup(i),!e&&a.propagationStopped)return"break"},s=this,a=0,c=this._subscriptions.slice();a<c.length;a++){if("break"===i(c[a]))break}},e.prototype.cleanup=function(e){if(e.isOnce&&e.isExecuted){var t=this._subscriptions.indexOf(e);t>-1&&this._subscriptions.splice(t,1)}},e.prototype.asEvent=function(){return this._wrap},e.prototype.clear=function(){this._subscriptions.splice(0,this._subscriptions.length)},e}();t.DispatcherBase=i;var s=function(){function e(){this._events={}}return e.prototype.get=function(e){var t=this._events[e];return t||(t=this.createDispatcher(),this._events[e]=t,t)},e.prototype.remove=function(e){delete this._events[e]},e}();t.EventListBase=s;var a=function(){function e(e){this._subscribe=function(t){return e.subscribe(t)},this._unsubscribe=function(t){return e.unsubscribe(t)},this._one=function(t){return e.one(t)},this._has=function(t){return e.has(t)},this._clear=function(){return e.clear()}}return e.prototype.subscribe=function(e){return this._subscribe(e)},e.prototype.sub=function(e){return this.subscribe(e)},e.prototype.unsubscribe=function(e){this._unsubscribe(e)},e.prototype.unsub=function(e){this.unsubscribe(e)},e.prototype.one=function(e){return this._one(e)},e.prototype.has=function(e){return this._has(e)},e.prototype.clear=function(){this._clear()},e}();t.DispatcherWrapper=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e){this.unsub=e,this.propagationStopped=!1}return e.prototype.stopPropagation=function(){this.propagationStopped=!0},e}();t.EventManagement=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(77);t.EventDispatcher=r.EventDispatcher,t.EventHandlingBase=r.EventHandlingBase,t.EventList=r.EventList},function(e,t,n){"use strict";var r,o=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var i=n(15),s=function(e){function t(){return e.call(this)||this}return o(t,e),t.prototype.dispatch=function(e,t){this._dispatch(!1,this,arguments)},t.prototype.dispatchAsync=function(e,t){this._dispatch(!0,this,arguments)},t.prototype.asEvent=function(){return e.prototype.asEvent.call(this)},t}(i.DispatcherBase);t.EventDispatcher=s;var a=function(e){function t(){return e.call(this)||this}return o(t,e),t.prototype.createDispatcher=function(){return new s},t}(i.EventListBase);t.EventList=a;var c=function(){function e(){this._events=new a}return Object.defineProperty(e.prototype,"events",{get:function(){return this._events},enumerable:!0,configurable:!0}),e.prototype.subscribe=function(e,t){this._events.get(e).subscribe(t)},e.prototype.sub=function(e,t){this.subscribe(e,t)},e.prototype.unsubscribe=function(e,t){this._events.get(e).unsubscribe(t)},e.prototype.unsub=function(e,t){this.unsubscribe(e,t)},e.prototype.one=function(e,t){this._events.get(e).one(t)},e.prototype.has=function(e,t){return this._events.get(e).has(t)},e}();t.EventHandlingBase=c},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(79);t.SimpleEventDispatcher=r.SimpleEventDispatcher,t.SimpleEventHandlingBase=r.SimpleEventHandlingBase,t.SimpleEventList=r.SimpleEventList},function(e,t,n){"use strict";var r,o=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var i=n(15),s=function(e){function t(){return e.call(this)||this}return o(t,e),t.prototype.dispatch=function(e){this._dispatch(!1,this,arguments)},t.prototype.dispatchAsync=function(e){this._dispatch(!0,this,arguments)},t.prototype.asEvent=function(){return e.prototype.asEvent.call(this)},t}(i.DispatcherBase);t.SimpleEventDispatcher=s;var a=function(e){function t(){return e.call(this)||this}return o(t,e),t.prototype.createDispatcher=function(){return new s},t}(i.EventListBase);t.SimpleEventList=a;var c=function(){function e(){this._events=new a}return Object.defineProperty(e.prototype,"events",{get:function(){return this._events},enumerable:!0,configurable:!0}),e.prototype.subscribe=function(e,t){this._events.get(e).subscribe(t)},e.prototype.sub=function(e,t){this.subscribe(e,t)},e.prototype.one=function(e,t){this._events.get(e).one(t)},e.prototype.has=function(e,t){return this._events.get(e).has(t)},e.prototype.unsubscribe=function(e,t){this._events.get(e).unsubscribe(t)},e.prototype.unsub=function(e,t){this.unsubscribe(e,t)},e}();t.SimpleEventHandlingBase=c},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(81);t.SignalDispatcher=r.SignalDispatcher,t.SignalHandlingBase=r.SignalHandlingBase,t.SignalList=r.SignalList},function(e,t,n){"use strict";var r,o=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var i=n(15),s=function(e){function t(){return e.call(this)||this}return o(t,e),t.prototype.dispatch=function(){this._dispatch(!1,this,arguments)},t.prototype.dispatchAsync=function(){this._dispatch(!0,this,arguments)},t.prototype.asEvent=function(){return e.prototype.asEvent.call(this)},t}(i.DispatcherBase);t.SignalDispatcher=s;var a=function(e){function t(){return e.call(this)||this}return o(t,e),t.prototype.createDispatcher=function(){return new s},t}(i.EventListBase);t.SignalList=a;var c=function(){function e(){this._events=new a}return Object.defineProperty(e.prototype,"events",{get:function(){return this._events},enumerable:!0,configurable:!0}),e.prototype.one=function(e,t){this._events.get(e).one(t)},e.prototype.has=function(e,t){return this._events.get(e).has(t)},e.prototype.subscribe=function(e,t){this._events.get(e).subscribe(t)},e.prototype.sub=function(e,t){this.subscribe(e,t)},e.prototype.unsubscribe=function(e,t){this._events.get(e).unsubscribe(t)},e.prototype.unsub=function(e,t){this.unsubscribe(e,t)},e}();t.SignalHandlingBase=c},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.AppLogger=class{constructor(e){this.app=e}information(...e){this.app.log(...e)}debug(...e){this.app.log(...e)}error(...e){this.app.error(...e)}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.ConsoleLogger=class{information(...e){console.log(...e)}debug(...e){console.log(...e)}error(...e){console.error(...e)}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(85);t.ConsoleReLogger=class{constructor(e){this.consolere=null,this.consolere=r.connect("console.re","80",e)}information(...e){console.re.information(...e)}debug(...e){console.re.log(...e)}error(...e){console.re.error(...e)}}},function(module,exports,__webpack_require__){exports=module.exports.connect=function(host,port,_channel,_cli){var root=this,io=__webpack_require__(86),cprotocol="443"===port?"https://":"http://",cport="",chost=host||"console.re",channel=_channel||"NodePublic",name="toServerRe",cli=_cli||!1;""!==port&&void 0!==port&&80!==port&&"https://"!==cprotocol&&(cport=":"+port);var isArray=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)};function getCaller(){try{throw new Error("")}catch(t){var e=[];return t.stack&&(5,e=t.stack.split("\n")[5].match(/\s*\(?([^\s\)]*)\)?$/)[1].match(/^.*([\/<][^\/>]*>?):(\d*):(\d*)$/)),{file:e?e[1]:"",line:e?e[2]:"0",col:e?e[3]:"0"}}}function getOtherTypes(t){var e,o="";try{e=eval(t),!0===e?o="[booltrue]true[/booltrue]":!1===e?o="[boolfalse]false[/boolfalse]":!isNaN(parseFloat(e))&&isFinite(e)?o="[number]"+e+"[/number]":"number"==typeof e?o="[number][Number][/number]":"string"==typeof e?o='"String"':"function"==typeof e?o="[Function]":e.nodeType?o="<"+e.nodeName+" Element>":"object"==typeof e?(o="{Object}",isArray(e)&&(o="[Array]")):o="[color=red]undefined[/color]"}catch(e){o="[color=red]"+e+"[/color]"}return o}function getType(e){var t="";if("string"!=typeof e)return getOtherTypes(e);try{var n=JSON.parse(e);"object"==typeof n?(t="{Object}",isArray(n)&&(t="[Array]")):t=getOtherTypes(e)}catch(n){t=getOtherTypes(e)}return t}function stringify(e){if("object"!=typeof e)return e;var t,n,r=[],o=[];return JSON.stringify(e,function(e,i){if(!i)return i;if("function"==typeof i)return"[Function]";if("object"==typeof i&&null!==i){if(i.length&&(t=Array.prototype.slice.call(i)).length===i.length&&(i=t),-1!==(n=r.indexOf(i)))return"[ Circular {"+(o[n]||"root")+"} ]";r.push(i),o.push(e)}return i})}root[name]=function(){var e,t=[],n=[],r=[],o=[],i={client:!0,server:!0,loaded:!1},s=["trace","debug","info","log","warn","error","size","test","assert","count","css","media","time","time","command"];function a(n,r,o,a){if(t=a||getCaller(),r.length&&-1!==s.indexOf(n)||"command"===n)return i.client&&function(e,t){if("trace"===e)return;if(console.log){var n=t.toString().replace(/\[(\w+)[^w]*?](.*?)\[\/\1]/g,"$2");Function.prototype.apply.call(console.log,console,["console.re ["+e+"]"].concat(n))}}.apply(null,arguments),i.server&&c.apply(null,arguments),e?void 0:i.connect()}function c(i,s,a){var c,u,l,h,p="";a=a||"","object"!=typeof s||s.length?("command"==i&&(p=a),c={command:p,channel:channel,browser:browser,level:i,args:s,caller:t}):c=s,"count"===a?(u=s.toString(),isNaN(r[u])?r[u]=1:r[u]++,s.push(r[u])):"time"===a?(l=s.toString(),o[l]=(new Date).getTime(),s.push("[white]started[/white]")):"timeEnd"===a&&(l=s.toString(),h=(new Date).getTime()-o[l],isNaN(h)?s.push("[white]not started[/white]"):s.push("[white]ends[/white] in [number]"+h+"[/number] ms"));for(var d=0;d<s.length;d++)s[d]=stringify(s[d],a,void 0);e?(n.length&&f(n),e.emit(name,c,function(t){"success"===t&&cli&&(console.log("Sent to http://"+chost+"/"+channel),e.disconnect())})):n.push([i,c])}for(var u,l=0;l<s.length;l++)u=s[l],i[u]=h(u);function h(e){return function(){return i._dispatch(e,[].slice.call(arguments)),this}}function p(){e&&e.emit("channel",channel),f(n)}function f(e){for(var t=null;t=e.shift();)c.apply(null,t)}return i.disconnect=function(){e.disconnect()},i.connect=function(t){io?((e=io.connect(cprotocol+chost+cport)).on("connect",p),e.on("error",function(e){console.log("console.re [error] "+e)})):t||i.connect(!0)},i.size=function(){return this},i.count=function(){return i._dispatch("count",[].slice.call(arguments),"count"),this},i.time=function(){return i._dispatch("time",[].slice.call(arguments),"time"),this},i.timeEnd=function(){return i._dispatch("time",[].slice.call(arguments),"timeEnd"),this},i.trace=function(){var e,t="",n=[].slice.call(arguments);try{throw new Error("")}catch(r){(e=r.stack.replace(/^\s+|\s+$/gm,"").split("\n").slice(2)).forEach(function(e){t=t+"\n    "+e}),console.log("console.re [trace] "+n.toString()+":",t)}return i._dispatch("trace",[n.toString(),e]),this},i.css=function(){return this},i.test=function(){var e=[].slice.call(arguments),t="",n=[];return e.forEach(function(e){t=getType(e),/|[Function]|{Object}|[Array]|Element|/gi.test(t)&&(t="[color=#BBB519]"+t+"[/color]"),n.push("[color=#BC9044]"+e+"[/color][color=gray] is [/color]"+t)}),i._dispatch("test",n),this},i.assert=function(){var e=[].slice.call(arguments),t=[];return e.forEach(function(n,r){"string"!=typeof n&&(n||("string"==typeof e[r+1]?t.push("[color=red]"+e[r+1]+"[/color]"):t.push("[color=red]Assertion Failure[/color]")))}),t.length&&i._dispatch("assert",t),this},i.media=function(){return this},i._dispatch=function(e,t,n,r){a(e,t,n,r)},i.clear=function(){return i._dispatch("command","","clear"),this},i}(),console.re=root[name],module.exports.re=root[name];var BrowserDetect={searchString:function(e){for(var t=0;t<e.length;t++)if(-1!=e[t].str.indexOf(e[t].substr))return e[t].name},dataOS:[{str:process.platform,substr:"win32",name:"Windows"},{str:process.platform,substr:"sunos",name:"SunOS"},{str:process.platform,substr:"darwin",name:"Mac"},{str:process.platform,substr:"linux",name:"Linux"}],init:function(){return{browser:{f:"NodeJs",s:"NJ"},version:process.versions.node||"",OS:this.searchString(this.dataOS)||"an unknown OS"}}},browser=BrowserDetect.init();return process.on("uncaughtException",function(e){console.re.error("[red]"+e.toString()+"[/red]")}),root}},function(e,t,n){e.exports=n(87)},function(e,t,n){var r=n(34),o=n(23),i=n(37),s=n(12)("socket.io-client");e.exports=t=c;var a=t.managers={};function c(e,t){"object"==typeof e&&(t=e,e=void 0),t=t||{};var n,o=r(e),c=o.source,u=o.id;return t.forceNew||t["force new connection"]||!1===t.multiplex?(s("ignoring socket cache for %s",c),n=i(c,t)):(a[u]||(s("new io instance for %s",c),a[u]=i(c,t)),n=a[u]),n.socket(o.path)}t.protocol=o.protocol,t.connect=c,t.Manager=n(37),t.Socket=n(49)},function(e,t){var n=/^(?:(?![^:@]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,r=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];e.exports=function(e){for(var t=n.exec(e||""),o={},i=14;i--;)o[r[i]]=t[i]||"";return o}},function(e,t,n){var r;/*! JSON v3.2.6 | http://bestiejs.github.io/json3 | Copyright 2012-2013, Kit Cambridge | http://kit.mit-license.org */!function(o){var i,s,a,c={}.toString,u=n(90),l="object"==typeof JSON&&JSON,h=t&&!t.nodeType&&t;h&&l?(h.stringify=l.stringify,h.parse=l.parse):h=o.JSON=l||{};var p=new Date(-0xc782b5b800cec);try{p=-109252==p.getUTCFullYear()&&0===p.getUTCMonth()&&1===p.getUTCDate()&&10==p.getUTCHours()&&37==p.getUTCMinutes()&&6==p.getUTCSeconds()&&708==p.getUTCMilliseconds()}catch(e){}function f(e){if(f[e]!==a)return f[e];var t;if("bug-string-char-index"==e)t="a"!="a"[0];else if("json"==e)t=f("json-stringify")&&f("json-parse");else{var n,r='{"a":[1,true,false,null,"\\u0000\\b\\n\\f\\r\\t"]}';if("json-stringify"==e){var o=h.stringify,i="function"==typeof o&&p;if(i){(n=function(){return 1}).toJSON=n;try{i="0"===o(0)&&"0"===o(new Number)&&'""'==o(new String)&&o(c)===a&&o(a)===a&&o()===a&&"1"===o(n)&&"[1]"==o([n])&&"[null]"==o([a])&&"null"==o(null)&&"[null,null,null]"==o([a,c,null])&&o({a:[n,!0,!1,null,"\0\b\n\f\r\t"]})==r&&"1"===o(null,n)&&"[\n 1,\n 2\n]"==o([1,2],null,1)&&'"-271821-04-20T00:00:00.000Z"'==o(new Date(-864e13))&&'"+275760-09-13T00:00:00.000Z"'==o(new Date(864e13))&&'"-000001-01-01T00:00:00.000Z"'==o(new Date(-621987552e5))&&'"1969-12-31T23:59:59.999Z"'==o(new Date(-1))}catch(e){i=!1}}t=i}if("json-parse"==e){var s=h.parse;if("function"==typeof s)try{if(0===s("0")&&!s(!1)){var u=5==(n=s(r)).a.length&&1===n.a[0];if(u){try{u=!s('"\t"')}catch(e){}if(u)try{u=1!==s("01")}catch(e){}if(u)try{u=1!==s("1.")}catch(e){}}}}catch(e){u=!1}t=u}}return f[e]=!!t}if(!f("json")){var d=f("bug-string-char-index");if(!p)var g=Math.floor,y=[0,31,59,90,120,151,181,212,243,273,304,334],v=function(e,t){return y[t]+365*(e-1970)+g((e-1969+(t=+(t>1)))/4)-g((e-1901+t)/100)+g((e-1601+t)/400)};(i={}.hasOwnProperty)||(i=function(e){var t,n={};return(n.__proto__=null,n.__proto__={toString:1},n).toString!=c?i=function(e){var t=this.__proto__,n=e in(this.__proto__=null,this);return this.__proto__=t,n}:(t=n.constructor,i=function(e){var n=(this.constructor||t).prototype;return e in this&&!(e in n&&this[e]===n[e])}),n=null,i.call(this,e)});var m={boolean:1,number:1,string:1,undefined:1};if(s=function(e,t){var n,r,o,a=0;for(o in(n=function(){this.valueOf=0}).prototype.valueOf=0,r=new n)i.call(r,o)&&a++;return n=r=null,a?s=2==a?function(e,t){var n,r={},o="[object Function]"==c.call(e);for(n in e)o&&"prototype"==n||i.call(r,n)||!(r[n]=1)||!i.call(e,n)||t(n)}:function(e,t){var n,r,o="[object Function]"==c.call(e);for(n in e)o&&"prototype"==n||!i.call(e,n)||(r="constructor"===n)||t(n);(r||i.call(e,n="constructor"))&&t(n)}:(r=["valueOf","toString","toLocaleString","propertyIsEnumerable","isPrototypeOf","hasOwnProperty","constructor"],s=function(e,t){var n,o,s="[object Function]"==c.call(e),a=!s&&"function"!=typeof e.constructor&&function(e,t){var n=typeof e[t];return"object"==n?!!e[t]:!m[n]}(e,"hasOwnProperty")?e.hasOwnProperty:i;for(n in e)s&&"prototype"==n||!a.call(e,n)||t(n);for(o=r.length;n=r[--o];a.call(e,n)&&t(n));}),s(e,t)},!f("json-stringify")){var b={92:"\\\\",34:'\\"',8:"\\b",12:"\\f",10:"\\n",13:"\\r",9:"\\t"},_=function(e,t){return("000000"+(t||0)).slice(-e)},w=function(e){var t,n='"',r=0,o=e.length,i=o>10&&d;for(i&&(t=e.split(""));r<o;r++){var s=e.charCodeAt(r);switch(s){case 8:case 9:case 10:case 12:case 13:case 34:case 92:n+=b[s];break;default:if(s<32){n+="\\u00"+_(2,s.toString(16));break}n+=i?t[r]:d?e.charAt(r):e[r]}}return n+'"'},E=function(e,t,n,r,o,u,l){var h,p,f,d,y,m,b,S,k,T,O,x,P,C,D,A;try{h=t[e]}catch(e){}if("object"==typeof h&&h)if("[object Date]"!=(p=c.call(h))||i.call(h,"toJSON"))"function"==typeof h.toJSON&&("[object Number]"!=p&&"[object String]"!=p&&"[object Array]"!=p||i.call(h,"toJSON"))&&(h=h.toJSON(e));else if(h>-1/0&&h<1/0){if(v){for(y=g(h/864e5),f=g(y/365.2425)+1970-1;v(f+1,0)<=y;f++);for(d=g((y-v(f,0))/30.42);v(f,d+1)<=y;d++);y=1+y-v(f,d),b=g((m=(h%864e5+864e5)%864e5)/36e5)%24,S=g(m/6e4)%60,k=g(m/1e3)%60,T=m%1e3}else f=h.getUTCFullYear(),d=h.getUTCMonth(),y=h.getUTCDate(),b=h.getUTCHours(),S=h.getUTCMinutes(),k=h.getUTCSeconds(),T=h.getUTCMilliseconds();h=(f<=0||f>=1e4?(f<0?"-":"+")+_(6,f<0?-f:f):_(4,f))+"-"+_(2,d+1)+"-"+_(2,y)+"T"+_(2,b)+":"+_(2,S)+":"+_(2,k)+"."+_(3,T)+"Z"}else h=null;if(n&&(h=n.call(t,e,h)),null===h)return"null";if("[object Boolean]"==(p=c.call(h)))return""+h;if("[object Number]"==p)return h>-1/0&&h<1/0?""+h:"null";if("[object String]"==p)return w(""+h);if("object"==typeof h){for(C=l.length;C--;)if(l[C]===h)throw TypeError();if(l.push(h),O=[],D=u,u+=o,"[object Array]"==p){for(P=0,C=h.length;P<C;P++)x=E(P,h,n,r,o,u,l),O.push(x===a?"null":x);A=O.length?o?"[\n"+u+O.join(",\n"+u)+"\n"+D+"]":"["+O.join(",")+"]":"[]"}else s(r||h,function(e){var t=E(e,h,n,r,o,u,l);t!==a&&O.push(w(e)+":"+(o?" ":"")+t)}),A=O.length?o?"{\n"+u+O.join(",\n"+u)+"\n"+D+"}":"{"+O.join(",")+"}":"{}";return l.pop(),A}};h.stringify=function(e,t,n){var r,o,i,s;if("function"==typeof t||"object"==typeof t&&t)if("[object Function]"==(s=c.call(t)))o=t;else if("[object Array]"==s){i={};for(var a,u=0,l=t.length;u<l;a=t[u++],("[object String]"==(s=c.call(a))||"[object Number]"==s)&&(i[a]=1));}if(n)if("[object Number]"==(s=c.call(n))){if((n-=n%1)>0)for(r="",n>10&&(n=10);r.length<n;r+=" ");}else"[object String]"==s&&(r=n.length<=10?n:n.slice(0,10));return E("",((a={})[""]=e,a),o,i,r,"",[])}}if(!f("json-parse")){var S,k,T=String.fromCharCode,O={92:"\\",34:'"',47:"/",98:"\b",116:"\t",110:"\n",102:"\f",114:"\r"},x=function(){throw S=k=null,SyntaxError()},P=function(){for(var e,t,n,r,o,i=k,s=i.length;S<s;)switch(o=i.charCodeAt(S)){case 9:case 10:case 13:case 32:S++;break;case 123:case 125:case 91:case 93:case 58:case 44:return e=d?i.charAt(S):i[S],S++,e;case 34:for(e="@",S++;S<s;)if((o=i.charCodeAt(S))<32)x();else if(92==o)switch(o=i.charCodeAt(++S)){case 92:case 34:case 47:case 98:case 116:case 110:case 102:case 114:e+=O[o],S++;break;case 117:for(t=++S,n=S+4;S<n;S++)(o=i.charCodeAt(S))>=48&&o<=57||o>=97&&o<=102||o>=65&&o<=70||x();e+=T("0x"+i.slice(t,S));break;default:x()}else{if(34==o)break;for(o=i.charCodeAt(S),t=S;o>=32&&92!=o&&34!=o;)o=i.charCodeAt(++S);e+=i.slice(t,S)}if(34==i.charCodeAt(S))return S++,e;x();default:if(t=S,45==o&&(r=!0,o=i.charCodeAt(++S)),o>=48&&o<=57){for(48==o&&((o=i.charCodeAt(S+1))>=48&&o<=57)&&x(),r=!1;S<s&&((o=i.charCodeAt(S))>=48&&o<=57);S++);if(46==i.charCodeAt(S)){for(n=++S;n<s&&((o=i.charCodeAt(n))>=48&&o<=57);n++);n==S&&x(),S=n}if(101==(o=i.charCodeAt(S))||69==o){for(43!=(o=i.charCodeAt(++S))&&45!=o||S++,n=S;n<s&&((o=i.charCodeAt(n))>=48&&o<=57);n++);n==S&&x(),S=n}return+i.slice(t,S)}if(r&&x(),"true"==i.slice(S,S+4))return S+=4,!0;if("false"==i.slice(S,S+5))return S+=5,!1;if("null"==i.slice(S,S+4))return S+=4,null;x()}return"$"},C=function(e){var t,n;if("$"==e&&x(),"string"==typeof e){if("@"==(d?e.charAt(0):e[0]))return e.slice(1);if("["==e){for(t=[];"]"!=(e=P());n||(n=!0))n&&(","==e?"]"==(e=P())&&x():x()),","==e&&x(),t.push(C(e));return t}if("{"==e){for(t={};"}"!=(e=P());n||(n=!0))n&&(","==e?"}"==(e=P())&&x():x()),","!=e&&"string"==typeof e&&"@"==(d?e.charAt(0):e[0])&&":"==P()||x(),t[e.slice(1)]=C(P());return t}x()}return e},D=function(e,t,n){var r=A(e,t,n);r===a?delete e[t]:e[t]=r},A=function(e,t,n){var r,o=e[t];if("object"==typeof o&&o)if("[object Array]"==c.call(o))for(r=o.length;r--;)D(o,r,n);else s(o,function(e){D(o,e,n)});return n.call(e,t,o)};h.parse=function(e,t){var n,r;return S=0,k=""+e,n=C(P()),"$"!=P()&&x(),S=k=null,t&&"[object Function]"==c.call(t)?A(((r={})[""]=n,r),"",t):n}}}u&&(void 0===(r=function(){return h}.call(t,n,t,e))||(e.exports=r))}(this)},function(e,t){(function(t){e.exports=t}).call(this,{})},function(e,t,n){var r=n(24),o=n(36);t.deconstructPacket=function(e){var t=[],n=e.data;var i=e;return i.data=function e(n){if(!n)return n;if(o(n)){var i={_placeholder:!0,num:t.length};return t.push(n),i}if(r(n)){for(var s=new Array(n.length),a=0;a<n.length;a++)s[a]=e(n[a]);return s}if("object"==typeof n&&!(n instanceof Date)){for(var c in s={},n)s[c]=e(n[c]);return s}return n}(n),i.attachments=t.length,{packet:i,buffers:t}},t.reconstructPacket=function(e,t){return e.data=function e(n){if(n&&n._placeholder)return t[n.num];if(r(n)){for(var o=0;o<n.length;o++)n[o]=e(n[o]);return n}if(n&&"object"==typeof n){for(var i in n)n[i]=e(n[i]);return n}return n}(e.data),e.attachments=void 0,e},t.removeBlobs=function(e,t){var n=0,i=e;!function e(s,a,c){if(!s)return s;if(global.Blob&&s instanceof Blob||global.File&&s instanceof File){n++;var u=new FileReader;u.onload=function(){c?c[a]=this.result:i=this.result,--n||t(i)},u.readAsArrayBuffer(s)}else if(r(s))for(var l=0;l<s.length;l++)e(s[l],l,s);else if(s&&"object"==typeof s&&!o(s))for(var h in s)e(s[h],h,s)}(i),n||t(i)}},function(e,t,n){e.exports=n(93)},function(e,t,n){e.exports=n(94),e.exports.parser=n(8)},function(e,t,n){var r=n(38),o=n(7),i=n(18)("engine.io-client:socket"),s=n(48),a=n(8),c=n(115),u=n(116),l=n(29);function h(e,t){if(!(this instanceof h))return new h(e,t);if(t=t||{},e&&"object"==typeof e&&(t=e,e=null),e&&(e=c(e),t.host=e.host,t.secure="https"==e.protocol||"wss"==e.protocol,t.port=e.port,e.query&&(t.query=e.query)),this.secure=null!=t.secure?t.secure:global.location&&"https:"==location.protocol,t.host){var n=t.host.split(":");t.hostname=n.shift(),n.length&&(t.port=n.pop())}this.agent=t.agent||!1,this.hostname=t.hostname||(global.location?location.hostname:"localhost"),this.port=t.port||(global.location&&location.port?location.port:this.secure?443:80),this.query=t.query||{},"string"==typeof this.query&&(this.query=l.decode(this.query)),this.upgrade=!1!==t.upgrade,this.path=(t.path||"/engine.io").replace(/\/$/,"")+"/",this.forceJSONP=!!t.forceJSONP,this.jsonp=!1!==t.jsonp,this.forceBase64=!!t.forceBase64,this.enablesXDR=!!t.enablesXDR,this.timestampParam=t.timestampParam||"t",this.timestampRequests=t.timestampRequests,this.transports=t.transports||["polling","websocket"],this.readyState="",this.writeBuffer=[],this.callbackBuffer=[],this.policyPort=t.policyPort||843,this.rememberUpgrade=t.rememberUpgrade||!1,this.open(),this.binaryType=null,this.onlyBinaryUpgrades=t.onlyBinaryUpgrades}e.exports=h,h.priorWebsocketSuccess=!1,o(h.prototype),h.protocol=a.protocol,h.Socket=h,h.Transport=n(28),h.transports=n(38),h.parser=n(8),h.prototype.createTransport=function(e){i('creating transport "%s"',e);var t=function(e){var t={};for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);return t}(this.query);return t.EIO=a.protocol,t.transport=e,this.id&&(t.sid=this.id),new r[e]({agent:this.agent,hostname:this.hostname,port:this.port,secure:this.secure,path:this.path,query:t,forceJSONP:this.forceJSONP,jsonp:this.jsonp,forceBase64:this.forceBase64,enablesXDR:this.enablesXDR,timestampRequests:this.timestampRequests,timestampParam:this.timestampParam,policyPort:this.policyPort,socket:this})},h.prototype.open=function(){var e;if(this.rememberUpgrade&&h.priorWebsocketSuccess&&-1!=this.transports.indexOf("websocket"))e="websocket";else{if(0==this.transports.length){var t=this;return void setTimeout(function(){t.emit("error","No transports available")},0)}e=this.transports[0]}this.readyState="opening";try{e=this.createTransport(e)}catch(e){return this.transports.shift(),void this.open()}e.open(),this.setTransport(e)},h.prototype.setTransport=function(e){i("setting transport %s",e.name);var t=this;this.transport&&(i("clearing existing transport %s",this.transport.name),this.transport.removeAllListeners()),this.transport=e,e.on("drain",function(){t.onDrain()}).on("packet",function(e){t.onPacket(e)}).on("error",function(e){t.onError(e)}).on("close",function(){t.onClose("transport close")})},h.prototype.probe=function(e){i('probing transport "%s"',e);var t=this.createTransport(e,{probe:1}),n=!1,r=this;function o(){if(r.onlyBinaryUpgrades){var o=!this.supportsBinary&&r.transport.supportsBinary;n=n||o}n||(i('probe transport "%s" opened',e),t.send([{type:"ping",data:"probe"}]),t.once("packet",function(o){if(!n)if("pong"==o.type&&"probe"==o.data){if(i('probe transport "%s" pong',e),r.upgrading=!0,r.emit("upgrading",t),!t)return;h.priorWebsocketSuccess="websocket"==t.name,i('pausing current transport "%s"',r.transport.name),r.transport.pause(function(){n||"closed"!=r.readyState&&(i("changing transport and sending upgrade packet"),p(),r.setTransport(t),t.send([{type:"upgrade"}]),r.emit("upgrade",t),t=null,r.upgrading=!1,r.flush())})}else{i('probe transport "%s" failed',e);var s=new Error("probe error");s.transport=t.name,r.emit("upgradeError",s)}}))}function s(){n||(n=!0,p(),t.close(),t=null)}function a(n){var o=new Error("probe error: "+n);o.transport=t.name,s(),i('probe transport "%s" failed because of error: %s',e,n),r.emit("upgradeError",o)}function c(){a("transport closed")}function u(){a("socket closed")}function l(e){t&&e.name!=t.name&&(i('"%s" works - aborting "%s"',e.name,t.name),s())}function p(){t.removeListener("open",o),t.removeListener("error",a),t.removeListener("close",c),r.removeListener("close",u),r.removeListener("upgrading",l)}h.priorWebsocketSuccess=!1,t.once("open",o),t.once("error",a),t.once("close",c),this.once("close",u),this.once("upgrading",l),t.open()},h.prototype.onOpen=function(){if(i("socket open"),this.readyState="open",h.priorWebsocketSuccess="websocket"==this.transport.name,this.emit("open"),this.flush(),"open"==this.readyState&&this.upgrade&&this.transport.pause){i("starting upgrade probes");for(var e=0,t=this.upgrades.length;e<t;e++)this.probe(this.upgrades[e])}},h.prototype.onPacket=function(e){if("opening"==this.readyState||"open"==this.readyState)switch(i('socket receive: type "%s", data "%s"',e.type,e.data),this.emit("packet",e),this.emit("heartbeat"),e.type){case"open":this.onHandshake(u(e.data));break;case"pong":this.setPing();break;case"error":var t=new Error("server error");t.code=e.data,this.emit("error",t);break;case"message":this.emit("data",e.data),this.emit("message",e.data)}else i('packet received with socket readyState "%s"',this.readyState)},h.prototype.onHandshake=function(e){this.emit("handshake",e),this.id=e.sid,this.transport.query.sid=e.sid,this.upgrades=this.filterUpgrades(e.upgrades),this.pingInterval=e.pingInterval,this.pingTimeout=e.pingTimeout,this.onOpen(),"closed"!=this.readyState&&(this.setPing(),this.removeListener("heartbeat",this.onHeartbeat),this.on("heartbeat",this.onHeartbeat))},h.prototype.onHeartbeat=function(e){clearTimeout(this.pingTimeoutTimer);var t=this;t.pingTimeoutTimer=setTimeout(function(){"closed"!=t.readyState&&t.onClose("ping timeout")},e||t.pingInterval+t.pingTimeout)},h.prototype.setPing=function(){var e=this;clearTimeout(e.pingIntervalTimer),e.pingIntervalTimer=setTimeout(function(){i("writing ping packet - expecting pong within %sms",e.pingTimeout),e.ping(),e.onHeartbeat(e.pingTimeout)},e.pingInterval)},h.prototype.ping=function(){this.sendPacket("ping")},h.prototype.onDrain=function(){for(var e=0;e<this.prevBufferLen;e++)this.callbackBuffer[e]&&this.callbackBuffer[e]();this.writeBuffer.splice(0,this.prevBufferLen),this.callbackBuffer.splice(0,this.prevBufferLen),this.prevBufferLen=0,0==this.writeBuffer.length?this.emit("drain"):this.flush()},h.prototype.flush=function(){"closed"!=this.readyState&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length&&(i("flushing %d packets in socket",this.writeBuffer.length),this.transport.send(this.writeBuffer),this.prevBufferLen=this.writeBuffer.length,this.emit("flush"))},h.prototype.write=h.prototype.send=function(e,t){return this.sendPacket("message",e,t),this},h.prototype.sendPacket=function(e,t,n){if("closing"!=this.readyState&&"closed"!=this.readyState){var r={type:e,data:t};this.emit("packetCreate",r),this.writeBuffer.push(r),this.callbackBuffer.push(n),this.flush()}},h.prototype.close=function(){if("opening"==this.readyState||"open"==this.readyState){this.readyState="closing";var e=this;function t(){e.onClose("forced close"),i("socket closing - telling transport to close"),e.transport.close()}function n(){e.removeListener("upgrade",n),e.removeListener("upgradeError",n),t()}function r(){e.once("upgrade",n),e.once("upgradeError",n)}this.writeBuffer.length?this.once("drain",function(){this.upgrading?r():t()}):this.upgrading?r():t()}return this},h.prototype.onError=function(e){i("socket error %j",e),h.priorWebsocketSuccess=!1,this.emit("error",e),this.onClose("transport error",e)},h.prototype.onClose=function(e,t){if("opening"==this.readyState||"open"==this.readyState||"closing"==this.readyState){i('socket close with reason: "%s"',e);var n=this;clearTimeout(this.pingIntervalTimer),clearTimeout(this.pingTimeoutTimer),setTimeout(function(){n.writeBuffer=[],n.callbackBuffer=[],n.prevBufferLen=0},0),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),this.readyState="closed",this.id=null,this.emit("close",e,t)}},h.prototype.filterUpgrades=function(e){for(var t=[],n=0,r=e.length;n<r;n++)~s(this.transports,e[n])&&t.push(e[n]);return t}},function(e,t){e.exports=require("child_process")},function(e,t,n){var r=n(25),o=n(40),i=n(7),s=n(17),a=n(18)("engine.io-client:polling-xhr");function c(){}function u(e){if(o.call(this,e),global.location){var t="https:"==location.protocol,n=location.port;n||(n=t?443:80),this.xd=e.hostname!=global.location.hostname||n!=e.port,this.xs=e.secure!=t}}function l(e){this.method=e.method||"GET",this.uri=e.uri,this.xd=!!e.xd,this.xs=!!e.xs,this.async=!1!==e.async,this.data=null!=e.data?e.data:null,this.agent=e.agent,this.isBinary=e.isBinary,this.supportsBinary=e.supportsBinary,this.enablesXDR=e.enablesXDR,this.create()}function h(){for(var e in l.requests)l.requests.hasOwnProperty(e)&&l.requests[e].abort()}e.exports=u,e.exports.Request=l,s(u,o),u.prototype.supportsBinary=!0,u.prototype.request=function(e){return(e=e||{}).uri=this.uri(),e.xd=this.xd,e.xs=this.xs,e.agent=this.agent||!1,e.supportsBinary=this.supportsBinary,e.enablesXDR=this.enablesXDR,new l(e)},u.prototype.doWrite=function(e,t){var n="string"!=typeof e&&void 0!==e,r=this.request({method:"POST",data:e,isBinary:n}),o=this;r.on("success",t),r.on("error",function(e){o.onError("xhr post error",e)}),this.sendXhr=r},u.prototype.doPoll=function(){a("xhr poll");var e=this.request(),t=this;e.on("data",function(e){t.onData(e)}),e.on("error",function(e){t.onError("xhr poll error",e)}),this.pollXhr=e},i(l.prototype),l.prototype.create=function(){var e=this.xhr=new r({agent:this.agent,xdomain:this.xd,xscheme:this.xs,enablesXDR:this.enablesXDR}),t=this;try{if(a("xhr open %s: %s",this.method,this.uri),e.open(this.method,this.uri,this.async),this.supportsBinary&&(e.responseType="arraybuffer"),"POST"==this.method)try{this.isBinary?e.setRequestHeader("Content-type","application/octet-stream"):e.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch(e){}"withCredentials"in e&&(e.withCredentials=!0),this.hasXDR()?(e.onload=function(){t.onLoad()},e.onerror=function(){t.onError(e.responseText)}):e.onreadystatechange=function(){4==e.readyState&&(200==e.status||1223==e.status?t.onLoad():setTimeout(function(){t.onError(e.status)},0))},a("xhr data %s",this.data),e.send(this.data)}catch(e){return void setTimeout(function(){t.onError(e)},0)}global.document&&(this.index=l.requestsCount++,l.requests[this.index]=this)},l.prototype.onSuccess=function(){this.emit("success"),this.cleanup()},l.prototype.onData=function(e){this.emit("data",e),this.onSuccess()},l.prototype.onError=function(e){this.emit("error",e),this.cleanup()},l.prototype.cleanup=function(){if(void 0!==this.xhr&&null!==this.xhr){this.hasXDR()?this.xhr.onload=this.xhr.onerror=c:this.xhr.onreadystatechange=c;try{this.xhr.abort()}catch(e){}global.document&&delete l.requests[this.index],this.xhr=null}},l.prototype.onLoad=function(){var e;try{var t;try{t=this.xhr.getResponseHeader("Content-Type").split(";")[0]}catch(e){}e="application/octet-stream"===t?this.xhr.response:this.supportsBinary?"ok":this.xhr.responseText}catch(e){this.onError(e)}null!=e&&this.onData(e)},l.prototype.hasXDR=function(){return void 0!==global.XDomainRequest&&!this.xs&&this.enablesXDR},l.prototype.abort=function(){this.cleanup()},global.document&&(l.requestsCount=0,l.requests={},global.attachEvent?global.attachEvent("onunload",h):global.addEventListener&&global.addEventListener("beforeunload",h,!1))},function(e,t,n){var r=n(98),o=n(100),i=n(101);t.protocol=3;var s=t.packets={open:0,close:1,ping:2,pong:3,message:4,upgrade:5,noop:6},a=i(s),c={type:"error",data:"parser error"};function u(e,t,n){for(var r=new Array(e.length),i=o(e.length,n),s=function(e,n,o){t(n,function(t,n){r[e]=n,o(t,r)})},a=0;a<e.length;a++)s(a,e[a],i)}function l(e){for(var t="",n=0;n<e.length;n++)t+=String.fromCharCode(e[n]);return t}function h(e){for(var t=new Buffer(e.length),n=0;n<e.length;n++)t.writeUInt8(e.charCodeAt(n),n);return t}t.encodePacket=function(e,n,o,i){"function"==typeof n&&(i=n,n=null),"function"==typeof o&&(i=o,o=null);var a=void 0===e.data?void 0:e.data.buffer||e.data;if(Buffer.isBuffer(a))return function(e,n,r){var o=e.data;if(!n)return t.encodeBase64Packet(e,r);var i=new Buffer(1);return i[0]=s[e.type],r(Buffer.concat([i,o]))}(e,n,i);if(a instanceof ArrayBuffer)return function(e,n,r){var o=void 0===e.data?void 0:e.data.buffer||e.data;if(!n)return t.encodeBase64Packet(e,r);var i=new Uint8Array(o),a=new Buffer(1+o.byteLength);a[0]=s[e.type];for(var c=0;c<i.length;c++)a[c+1]=i[c];return r(a)}(e,n,i);var c=s[e.type];return void 0!==e.data&&(c+=o?r.encode(String(e.data)):String(e.data)),i(""+c)},t.encodeBase64Packet=function(e,t){var n=e.data.buffer||e.data;if(n instanceof ArrayBuffer){for(var r=new Buffer(n.byteLength),o=0;o<r.length;o++)r[o]=n[o];e.data=r}var i="b"+s[e.type];return t(i+=e.data.toString("base64"))},t.decodePacket=function(e,n,o){if("string"==typeof e||void 0===e){if("b"==e.charAt(0))return t.decodeBase64Packet(e.substr(1),n);var i=e.charAt(0);if(o)try{e=r.decode(e)}catch(e){return c}return Number(i)==i&&a[i]?e.length>1?{type:a[i],data:e.substring(1)}:{type:a[i]}:c}if("arraybuffer"===n){i=e[0];for(var s=new Uint8Array(e.length-1),u=1;u<e.length;u++)s[u-1]=e[u];return{type:a[i],data:s.buffer}}i=e[0];return{type:a[i],data:e.slice(1)}},t.decodeBase64Packet=function(e,t){var n=a[e.charAt(0)],r=new Buffer(e.substr(1),"base64");if("arraybuffer"===t){for(var o=new Uint8Array(r.length),i=0;i<o.length;i++)o[i]=r[i];r=o.buffer}return{type:n,data:r}},t.encodePayload=function(e,n,r){if("function"==typeof n&&(r=n,n=null),n)return t.encodePayloadAsBinary(e,r);if(!e.length)return r("0:");u(e,function(e,r){t.encodePacket(e,n,!0,function(e){r(null,function(e){return e.length+":"+e}(e))})},function(e,t){return r(t.join(""))})},t.decodePayload=function(e,n,r){if("string"!=typeof e)return t.decodePayloadAsBinary(e,n,r);var o;if("function"==typeof n&&(r=n,n=null),""==e)return r(c,0,1);for(var i,s,a="",u=0,l=e.length;u<l;u++){var h=e.charAt(u);if(":"!=h)a+=h;else{if(""==a||a!=(i=Number(a)))return r(c,0,1);if(a!=(s=e.substr(u+1,i)).length)return r(c,0,1);if(s.length){if(o=t.decodePacket(s,n,!0),c.type==o.type&&c.data==o.data)return r(c,0,1);if(!1===r(o,u+i,l))return}u+=i,a=""}}return""!=a?r(c,0,1):void 0},t.encodePayloadAsBinary=function(e,n){if(!e.length)return n(new Buffer(0));u(e,function(e,n){t.encodePacket(e,!0,!0,function(e){if("string"==typeof e){var t=""+e.length;(o=new Buffer(t.length+2))[0]=0;for(var r=0;r<t.length;r++)o[r+1]=parseInt(t[r],10);return o[o.length-1]=255,n(null,Buffer.concat([o,h(e)]))}var o;for(t=""+e.length,(o=new Buffer(t.length+2))[0]=1,r=0;r<t.length;r++)o[r+1]=parseInt(t[r],10);o[o.length-1]=255,n(null,Buffer.concat([o,e]))})},function(e,t){return n(Buffer.concat(t))})},t.decodePayloadAsBinary=function(e,n,r){"function"==typeof n&&(r=n,n=null);for(var o=e,i=[];o.length>0;){for(var s="",a=0===o[0],u=!1,h=1;255!=o[h];h++){if(s.length>310){u=!0;break}s+=""+o[h]}if(u)return r(c,0,1);o=o.slice(s.length+1);var p=parseInt(s,10),f=o.slice(1,p+1);a&&(f=l(f)),i.push(f),o=o.slice(p+1)}var d=i.length;i.forEach(function(e,o){r(t.decodePacket(e,n,!0),o,d)})}},function(e,t,n){(function(e){var r;/*! http://mths.be/utf8js v2.0.0 by @mathias */!function(o){var i=t,s=(e&&e.exports,"object"==typeof global&&global);s.global!==s&&s.window;var a,c,u,l=String.fromCharCode;function h(e){for(var t,n,r=[],o=0,i=e.length;o<i;)(t=e.charCodeAt(o++))>=55296&&t<=56319&&o<i?56320==(64512&(n=e.charCodeAt(o++)))?r.push(((1023&t)<<10)+(1023&n)+65536):(r.push(t),o--):r.push(t);return r}function p(e,t){return l(e>>t&63|128)}function f(e){if(0==(4294967168&e))return l(e);var t="";return 0==(4294965248&e)?t=l(e>>6&31|192):0==(4294901760&e)?(t=l(e>>12&15|224),t+=p(e,6)):0==(4292870144&e)&&(t=l(e>>18&7|240),t+=p(e,12),t+=p(e,6)),t+=l(63&e|128)}function d(){if(u>=c)throw Error("Invalid byte index");var e=255&a[u];if(u++,128==(192&e))return 63&e;throw Error("Invalid continuation byte")}function g(){var e,t;if(u>c)throw Error("Invalid byte index");if(u==c)return!1;if(e=255&a[u],u++,0==(128&e))return e;if(192==(224&e)){if((t=(31&e)<<6|d())>=128)return t;throw Error("Invalid continuation byte")}if(224==(240&e)){if((t=(15&e)<<12|d()<<6|d())>=2048)return t;throw Error("Invalid continuation byte")}if(240==(248&e)&&(t=(15&e)<<18|d()<<12|d()<<6|d())>=65536&&t<=1114111)return t;throw Error("Invalid UTF-8 detected")}var y={version:"2.0.0",encode:function(e){for(var t=h(e),n=t.length,r=-1,o="";++r<n;)o+=f(t[r]);return o},decode:function(e){a=h(e),c=a.length,u=0;for(var t,n=[];!1!==(t=g());)n.push(t);return function(e){for(var t,n=e.length,r=-1,o="";++r<n;)(t=e[r])>65535&&(o+=l((t-=65536)>>>10&1023|55296),t=56320|1023&t),o+=l(t);return o}(n)}};void 0===(r=function(){return y}.call(t,n,t,e))||(e.exports=r)}()}).call(this,n(99)(e))},function(e,t){e.exports=function(e){return e.webpackPolyfill||(e.deprecate=function(){},e.paths=[],e.children||(e.children=[]),Object.defineProperty(e,"loaded",{enumerable:!0,get:function(){return e.l}}),Object.defineProperty(e,"id",{enumerable:!0,get:function(){return e.i}}),e.webpackPolyfill=1),e}},function(e,t){function n(){}e.exports=function(e,t,r){var o=!1;return r=r||n,i.count=e,0===e?t():i;function i(e,n){if(i.count<=0)throw new Error("after called too many times");--i.count,e?(o=!0,t(e),t=r):0!==i.count||o||t(null,n)}}},function(e,t){e.exports=Object.keys||function(e){var t=[],n=Object.prototype.hasOwnProperty;for(var r in e)n.call(e,r)&&t.push(r);return t}},function(e,t,n){(t=e.exports=function(e){function n(){}function i(){var e=i,n=+new Date,s=n-(r||n);e.diff=s,e.prev=r,e.curr=n,r=n,null==e.useColors&&(e.useColors=t.useColors()),null==e.color&&e.useColors&&(e.color=t.colors[o++%t.colors.length]);var a=Array.prototype.slice.call(arguments);a[0]=t.coerce(a[0]),"string"!=typeof a[0]&&(a=["%o"].concat(a));var c=0;a[0]=a[0].replace(/%([a-z%])/g,function(n,r){if("%%"===n)return n;c++;var o=t.formatters[r];if("function"==typeof o){var i=a[c];n=o.call(e,i),a.splice(c,1),c--}return n}),"function"==typeof t.formatArgs&&(a=t.formatArgs.apply(e,a));var u=i.log||t.log||console.log.bind(console);u.apply(e,a)}n.enabled=!1,i.enabled=!0;var s=t.enabled(e)?i:n;return s.namespace=e,s}).coerce=function(e){return e instanceof Error?e.stack||e.message:e},t.disable=function(){t.enable("")},t.enable=function(e){t.save(e);for(var n=(e||"").split(/[\s,]+/),r=n.length,o=0;o<r;o++)n[o]&&("-"===(e=n[o].replace(/\*/g,".*?"))[0]?t.skips.push(new RegExp("^"+e.substr(1)+"$")):t.names.push(new RegExp("^"+e+"$")))},t.enabled=function(e){var n,r;for(n=0,r=t.skips.length;n<r;n++)if(t.skips[n].test(e))return!1;for(n=0,r=t.names.length;n<r;n++)if(t.names[n].test(e))return!0;return!1},t.humanize=n(103),t.names=[],t.skips=[],t.formatters={};var r,o=0},function(e,t){var n=1e3,r=60*n,o=60*r,i=24*o,s=365.25*i;function a(e,t,n){if(!(e<t))return e<1.5*t?Math.floor(e/t)+" "+n:Math.ceil(e/t)+" "+n+"s"}e.exports=function(e,t){return t=t||{},"string"==typeof e?function(e){var t=/^((?:\d+)?\.?\d+) *(ms|seconds?|s|minutes?|m|hours?|h|days?|d|years?|y)?$/i.exec(e);if(!t)return;var a=parseFloat(t[1]);switch((t[2]||"ms").toLowerCase()){case"years":case"year":case"y":return a*s;case"days":case"day":case"d":return a*i;case"hours":case"hour":case"h":return a*o;case"minutes":case"minute":case"m":return a*r;case"seconds":case"second":case"s":return a*n;case"ms":return a}}(e):t.long?a(c=e,i,"day")||a(c,o,"hour")||a(c,r,"minute")||a(c,n,"second")||c+" ms":function(e){return e>=i?Math.round(e/i)+"d":e>=o?Math.round(e/o)+"h":e>=r?Math.round(e/r)+"m":e>=n?Math.round(e/n)+"s":e+"ms"}(e);var c}},function(e,t,n){var r=n(40),o=n(17);e.exports=u;var i,s=/\n/g,a=/\\n/g;function c(){}function u(e){r.call(this,e),this.query=this.query||{},i||(global.___eio||(global.___eio=[]),i=global.___eio),this.index=i.length;var t=this;i.push(function(e){t.onData(e)}),this.query.j=this.index,global.document&&global.addEventListener&&global.addEventListener("beforeunload",function(){t.script&&(t.script.onerror=c)},!1)}o(u,r),u.prototype.supportsBinary=!1,u.prototype.doClose=function(){this.script&&(this.script.parentNode.removeChild(this.script),this.script=null),this.form&&(this.form.parentNode.removeChild(this.form),this.form=null,this.iframe=null),r.prototype.doClose.call(this)},u.prototype.doPoll=function(){var e=this,t=document.createElement("script");this.script&&(this.script.parentNode.removeChild(this.script),this.script=null),t.async=!0,t.src=this.uri(),t.onerror=function(t){e.onError("jsonp poll error",t)};var n=document.getElementsByTagName("script")[0];n.parentNode.insertBefore(t,n),this.script=t,"undefined"!=typeof navigator&&/gecko/i.test(navigator.userAgent)&&setTimeout(function(){var e=document.createElement("iframe");document.body.appendChild(e),document.body.removeChild(e)},100)},u.prototype.doWrite=function(e,t){var n=this;if(!this.form){var r,o=document.createElement("form"),i=document.createElement("textarea"),c=this.iframeId="eio_iframe_"+this.index;o.className="socketio",o.style.position="absolute",o.style.top="-1000px",o.style.left="-1000px",o.target=c,o.method="POST",o.setAttribute("accept-charset","utf-8"),i.name="d",o.appendChild(i),document.body.appendChild(o),this.form=o,this.area=i}function u(){l(),t()}function l(){if(n.iframe)try{n.form.removeChild(n.iframe)}catch(e){n.onError("jsonp polling iframe removal error",e)}try{var e='<iframe src="javascript:0" name="'+n.iframeId+'">';r=document.createElement(e)}catch(e){(r=document.createElement("iframe")).name=n.iframeId,r.src="javascript:0"}r.id=n.iframeId,n.form.appendChild(r),n.iframe=r}this.form.action=this.uri(),l(),e=e.replace(a,"\\\n"),this.area.value=e.replace(s,"\\n");try{this.form.submit()}catch(e){}this.iframe.attachEvent?this.iframe.onreadystatechange=function(){"complete"==n.iframe.readyState&&u()}:this.iframe.onload=u}},function(e,t,n){var r=n(28),o=n(8),i=n(29),s=n(17),a=n(18)("engine.io-client:websocket"),c=n(106);function u(e){e&&e.forceBase64&&(this.supportsBinary=!1),r.call(this,e)}e.exports=u,s(u,r),u.prototype.name="websocket",u.prototype.supportsBinary=!0,u.prototype.doOpen=function(){if(this.check()){var e=this.uri(),t={agent:this.agent};this.ws=new c(e,void 0,t),void 0===this.ws.binaryType&&(this.supportsBinary=!1),this.ws.binaryType="arraybuffer",this.addEventListeners()}},u.prototype.addEventListeners=function(){var e=this;this.ws.onopen=function(){e.onOpen()},this.ws.onclose=function(){e.onClose()},this.ws.onmessage=function(t){e.onData(t.data)},this.ws.onerror=function(t){e.onError("websocket error",t)}},"undefined"!=typeof navigator&&/iPad|iPhone|iPod/i.test(navigator.userAgent)&&(u.prototype.onData=function(e){var t=this;setTimeout(function(){r.prototype.onData.call(t,e)},0)}),u.prototype.write=function(e){var t=this;this.writable=!1;for(var n=0,r=e.length;n<r;n++)o.encodePacket(e[n],this.supportsBinary,function(e){try{t.ws.send(e)}catch(e){a("websocket closed before onclose event")}});setTimeout(function(){t.writable=!0,t.emit("drain")},0)},u.prototype.onClose=function(){r.prototype.onClose.call(this)},u.prototype.doClose=function(){void 0!==this.ws&&this.ws.close()},u.prototype.uri=function(){var e=this.query||{},t=this.secure?"wss":"ws",n="";return this.port&&("wss"==t&&443!=this.port||"ws"==t&&80!=this.port)&&(n=":"+this.port),this.timestampRequests&&(e[this.timestampParam]=+new Date),this.supportsBinary||(e.b64=1),(e=i.encode(e)).length&&(e="?"+e),t+"://"+this.hostname+n+this.path+e},u.prototype.check=function(){return!(!c||"__initialize"in c&&this.name===u.prototype.name)}},function(e,t,n){
/*!
 * ws: a node.js websocket client
 * Copyright(c) 2011 Einar Otto Stangvik <einaros@gmail.com>
 * MIT Licensed
 */
e.exports=n(41),e.exports.Server=n(113),e.exports.Sender=n(44),e.exports.Receiver=n(47),e.exports.createServer=function(t,n){var r=new e.exports.Server(t);return"function"==typeof n&&r.on("connection",n),r},e.exports.connect=e.exports.createConnection=function(t,n){var r=new e.exports(t);return"function"==typeof n&&r.on("open",n),r}},function(e,t){
/*!
 * ws: a node.js websocket client
 * Copyright(c) 2011 Einar Otto Stangvik <einaros@gmail.com>
 * MIT Licensed
 */
e.exports.BufferUtil={merge:function(e,t){for(var n=0,r=0,o=t.length;r<o;++r){var i=t[r];i.copy(e,n),n+=i.length}},mask:function(e,t,n,r,o){for(var i=t.readUInt32LE(0,!0),s=0;s<o-3;s+=4){var a=i^e.readUInt32LE(s,!0);a<0&&(a=4294967296+a),n.writeUInt32LE(a,r+s,!0)}switch(o%4){case 3:n[r+s+2]=e[s+2]^t[2];case 2:n[r+s+1]=e[s+1]^t[1];case 1:n[r+s]=e[s]^t[0]}},unmask:function(e,t){for(var n=t.readUInt32LE(0,!0),r=e.length,o=0;o<r-3;o+=4){var i=n^e.readUInt32LE(o,!0);i<0&&(i=4294967296+i),e.writeUInt32LE(i,o,!0)}switch(r%4){case 3:e[o+2]=e[o+2]^t[2];case 2:e[o+1]=e[o+1]^t[1];case 1:e[o]=e[o]^t[0]}}}},function(e,t,n){
/*!
 * ws: a node.js websocket client
 * Copyright(c) 2011 Einar Otto Stangvik <einaros@gmail.com>
 * MIT Licensed
 */
try{e.exports=n(!function(){var e=new Error("Cannot find module '../build/Release/validation'");throw e.code="MODULE_NOT_FOUND",e}())}catch(t){try{e.exports=n(!function(){var e=new Error("Cannot find module '../build/default/validation'");throw e.code="MODULE_NOT_FOUND",e}())}catch(t){try{e.exports=n(109)}catch(e){throw console.error("validation.node seems to not have been built. Run npm install."),e}}}},function(e,t){
/*!
 * ws: a node.js websocket client
 * Copyright(c) 2011 Einar Otto Stangvik <einaros@gmail.com>
 * MIT Licensed
 */
e.exports.Validation={isValidUTF8:function(e){return!0}}},function(e,t,n){
/*!
 * ws: a node.js websocket client
 * Copyright(c) 2011 Einar Otto Stangvik <einaros@gmail.com>
 * MIT Licensed
 */
n(4);function r(e,t,n){"function"==typeof e?(n=t,t=e,e=0):void 0===e&&(e=0),this._growStrategy=(t||function(e,t){return e.used+t}).bind(null,this),this._shrinkStrategy=(n||function(t){return e}).bind(null,this),this._buffer=e?new Buffer(e):null,this._offset=0,this._used=0,this._changeFactor=0,this.__defineGetter__("size",function(){return null==this._buffer?0:this._buffer.length}),this.__defineGetter__("used",function(){return this._used})}r.prototype.get=function(e){if(null==this._buffer||this._offset+e>this._buffer.length){var t=new Buffer(this._growStrategy(e));this._buffer=t,this._offset=0}this._used+=e;var n=this._buffer.slice(this._offset,this._offset+e);return this._offset+=e,n},r.prototype.reset=function(e){var t=this._shrinkStrategy();t<this.size&&(this._changeFactor-=1),(e||this._changeFactor<-2)&&(this._changeFactor=0,this._buffer=t?new Buffer(t):null),this._offset=0,this._used=0},e.exports=r},function(e,t,n){
/*!
 * ws: a node.js websocket client
 * Copyright(c) 2011 Einar Otto Stangvik <einaros@gmail.com>
 * MIT Licensed
 */
var r=n(19),o=n(4);r.EventEmitter;function i(e){this.socket=e,this.continuationFrame=!1,this.isClosed=!1}e.exports=i,o.inherits(i,r.EventEmitter),i.prototype.send=function(e,t,n){if(!this.isClosed){var r="string"==typeof e,o=r?Buffer.byteLength(e):e.length,i=o>127?2:1,s=0==this.continuationFrame,a=!t||!(void 0!==t.fin&&!t.fin),c=new Buffer((s?t&&t.binary?1+i:1:0)+o+(!a||t&&t.binary?0:1)),u=s?1:0;s&&(t&&t.binary?(c.write("","binary"),i>1&&c.write(String.fromCharCode(128+o/128),u++,"binary"),c.write(String.fromCharCode(127&o),u++,"binary")):c.write("\0","binary")),r?c.write(e,u,"utf8"):e.copy(c,u,0),a?(t&&t.binary||c.write("ÿ",u+o,"binary"),this.continuationFrame=!1):this.continuationFrame=!0;try{this.socket.write(c,"binary",n)}catch(e){this.error(e.toString())}}},i.prototype.close=function(e,t,n,r){if(!this.isClosed){this.isClosed=!0;try{this.continuationFrame&&this.socket.write(new Buffer([255],"binary")),this.socket.write(new Buffer([255,0]),"binary",r)}catch(e){this.error(e.toString())}}},i.prototype.ping=function(e,t){},i.prototype.pong=function(e,t){},i.prototype.error=function(e){return this.emit("error",e),this}},function(e,t,n){
/*!
 * ws: a node.js websocket client
 * Copyright(c) 2011 Einar Otto Stangvik <einaros@gmail.com>
 * MIT Licensed
 */
n(4);var r=0,o=1,i=2,s=3;function a(){this.state=r,this.buffers=[],this.messageEnd=-1,this.spanLength=0,this.dead=!1,this.onerror=function(){},this.ontext=function(){},this.onbinary=function(){},this.onclose=function(){},this.onping=function(){},this.onpong=function(){}}e.exports=a,a.prototype.add=function(e){var t=this;function n(){if(t.state===r){if(2==e.length&&255==e[0]&&0==e[1])return t.reset(),void t.onclose();if(128===e[0])t.messageEnd=0,t.state=i,e=e.slice(1);else{if(0!==e[0])return void t.error("payload must start with 0x00 byte",!0);e=e.slice(1),t.state=o}}if(t.state===i){for(var n=0;n<e.length&&128&e[n];)t.messageEnd=128*t.messageEnd+(127&e[n]),++n;n<e.length&&(t.messageEnd=128*t.messageEnd+(127&e[n]),t.state=s,++n),n>0&&(e=e.slice(n))}if(t.state===s){var a=t.messageEnd-t.spanLength;return e.length>=a?(t.buffers.push(e),t.spanLength+=a,t.messageEnd=a,t.parse()):(t.buffers.push(e),void(t.spanLength+=e.length))}if(t.buffers.push(e),-1!=(t.messageEnd=function(e,t){for(var n=0,r=e.length;n<r;++n)if(e[n]===t)return n;return-1}(e,255)))return t.spanLength+=t.messageEnd,t.parse();t.spanLength+=e.length}for(;e;)e=n()},a.prototype.cleanup=function(){this.dead=!0,this.state=r,this.buffers=[]},a.prototype.parse=function(){for(var e=new Buffer(this.spanLength),t=0,n=0,r=this.buffers.length;n<r-1;++n){var i=this.buffers[n];i.copy(e,t),t+=i.length}var s=this.buffers[this.buffers.length-1];this.messageEnd>0&&s.copy(e,t,0,this.messageEnd),this.state!==o&&--this.messageEnd;var a=null;return this.messageEnd<s.length-1&&(a=s.slice(this.messageEnd+1)),this.reset(),this.ontext(e.toString("utf8")),a},a.prototype.error=function(e,t){return this.reset(),this.onerror(e,t),this},a.prototype.reset=function(e){this.dead||(this.state=r,this.buffers=[],this.messageEnd=-1,this.spanLength=0)}},function(e,t,n){
/*!
 * ws: a node.js websocket client
 * Copyright(c) 2011 Einar Otto Stangvik <einaros@gmail.com>
 * MIT Licensed
 */
var r=n(4),o=n(19),i=n(27),s=n(42),a=n(16),c=n(43),u=n(41);n(114),a=n(16);function l(e,t){if(!(e=new c({host:"0.0.0.0",port:null,server:null,verifyClient:null,handleProtocols:null,path:null,noServer:!1,disableHixie:!1,clientTracking:!0}).merge(e)).isDefinedAndNonNull("port")&&!e.isDefinedAndNonNull("server")&&!e.value.noServer)throw new TypeError("`port` or a `server` must be provided");var n=this;if(e.isDefinedAndNonNull("port"))this._server=i.createServer(function(e,t){t.writeHead(200,{"Content-Type":"text/plain"}),t.end("Not implemented")}),this._server.listen(e.value.port,e.value.host,t),this._closeServer=function(){n._server.close()};else if(e.value.server&&(this._server=e.value.server,e.value.path)){if(this._server._webSocketPaths&&e.value.server._webSocketPaths[e.value.path])throw new Error("two instances of WebSocketServer cannot listen on the same http server path");"object"!=typeof this._server._webSocketPaths&&(this._server._webSocketPaths={}),this._server._webSocketPaths[e.value.path]=1}this._server&&this._server.once("listening",function(){n.emit("listening")}),void 0!==this._server&&(this._server.on("error",function(e){n.emit("error",e)}),this._server.on("upgrade",function(e,t,r){var o=new Buffer(r.length);r.copy(o),n.handleUpgrade(e,t,o,function(t){n.emit("connection"+e.url,t),n.emit("connection",t)})})),this.options=e.value,this.path=e.value.path,this.clients=[]}function h(e,t,n){try{var r=["HTTP/1.1 "+t+" "+n,"Content-type: text/html"];e.write(r.concat("","").join("\r\n"))}catch(e){}finally{try{e.destroy()}catch(e){}}}r.inherits(l,o.EventEmitter),l.prototype.close=function(){var e=null;try{for(var t=0,n=this.clients.length;t<n;++t)this.clients[t].terminate()}catch(t){e=t}this.path&&this._server._webSocketPaths&&(delete this._server._webSocketPaths[this.path],0==Object.keys(this._server._webSocketPaths).length&&delete this._server._webSocketPaths);try{void 0!==this._closeServer&&this._closeServer()}finally{delete this._server}if(e)throw e},l.prototype.handleUpgrade=function(e,t,n,r){if(this.options.path){var o=a.parse(e.url);if(o&&o.pathname!==this.options.path)return}void 0!==e.headers.upgrade&&"websocket"===e.headers.upgrade.toLowerCase()?e.headers["sec-websocket-key1"]?function(e,t,n,r){var o=function(){try{t.destroy()}catch(e){}};if(t.on("error",o),this.options.disableHixie)return void h(t,401,"Hixie support disabled");if(!e.headers["sec-websocket-key2"])return void h(t,400,"Bad Request");var i=e.headers.origin,a=this,c=function(){var c;c=e.headers["x-forwarded-host"]?e.headers["x-forwarded-host"]:e.headers.host;var l=("https"===e.headers["x-forwarded-proto"]||t.encrypted?"wss":"ws")+"://"+c+e.url,p=e.headers["sec-websocket-protocol"],f=function(n,c){var f=e.headers["sec-websocket-key1"],d=e.headers["sec-websocket-key2"],g=s.createHash("md5");[f,d].forEach(function(e){var n=parseInt(e.replace(/[^\d]/g,"")),r=e.replace(/[^ ]/g,"").length;0!==r&&n%r==0?(n/=r,g.update(String.fromCharCode(n>>24&255,n>>16&255,n>>8&255,255&n))):h(t,400,"Bad Request")}),g.update(n.toString("binary"));var y=["HTTP/1.1 101 Switching Protocols","Upgrade: WebSocket","Connection: Upgrade","Sec-WebSocket-Location: "+l];void 0!==p&&y.push("Sec-WebSocket-Protocol: "+p),void 0!==i&&y.push("Sec-WebSocket-Origin: "+i),t.setTimeout(0),t.setNoDelay(!0);try{var v=new Buffer(y.concat("","").join("\r\n")),m=new Buffer(g.digest("binary"),"binary"),b=new Buffer(v.length+m.length);v.copy(b,0),m.copy(b,v.length),t.write(b,"binary",function(n){if(!n){var i=new u([e,t,c],{protocolVersion:"hixie-76",protocol:p});a.options.clientTracking&&(a.clients.push(i),i.on("close",function(){var e=a.clients.indexOf(i);-1!=e&&a.clients.splice(e,1)})),t.removeListener("error",o),r(i)}})}catch(e){try{t.destroy()}catch(e){}return}};if(n&&n.length>=8){var d=n.slice(0,8),g=n.length>8?n.slice(8):null;f.call(a,d,g)}else{var d=new Buffer(8);n.copy(d,0);var y=n.length,g=null,v=function(e){var n=Math.min(e.length,8-y);0!==n&&(e.copy(d,y,0,n),8==(y+=n)&&(t.removeListener("data",v),n<e.length&&(g=e.slice(n)),f.call(a,d,g)))};t.on("data",v)}};if("function"==typeof this.options.verifyClient){var l={origin:i,secure:void 0!==e.connection.authorized||void 0!==e.connection.encrypted,req:e};if(2==this.options.verifyClient.length){var a=this;return void this.options.verifyClient(l,function(e){e?c.apply(a):h(t,401,"Unauthorized")})}if(!this.options.verifyClient(l))return void h(t,401,"Unauthorized")}c()}.apply(this,arguments):function(e,t,n,r){var o=function(){try{t.destroy()}catch(e){}};if(t.on("error",o),!e.headers["sec-websocket-key"])return void h(t,400,"Bad Request");var i=parseInt(e.headers["sec-websocket-version"]);if(-1===[8,13].indexOf(i))return void h(t,400,"Bad Request");var a=e.headers["sec-websocket-protocol"],c=i<13?e.headers["sec-websocket-origin"]:e.headers.origin,l=this,p=function(a){var c=e.headers["sec-websocket-key"],h=s.createHash("sha1");h.update(c+"258EAFA5-E914-47DA-95CA-C5AB0DC85B11");var p=["HTTP/1.1 101 Switching Protocols","Upgrade: websocket","Connection: Upgrade","Sec-WebSocket-Accept: "+(c=h.digest("base64"))];void 0!==a&&p.push("Sec-WebSocket-Protocol: "+a),l.emit("headers",p),t.setTimeout(0),t.setNoDelay(!0);try{t.write(p.concat("","").join("\r\n"))}catch(e){try{t.destroy()}catch(e){}return}var f=new u([e,t,n],{protocolVersion:i,protocol:a});l.options.clientTracking&&(l.clients.push(f),f.on("close",function(){var e=l.clients.indexOf(f);-1!=e&&l.clients.splice(e,1)})),t.removeListener("error",o),r(f)},f=function(){if("function"!=typeof l.options.handleProtocols)void 0!==a?p(a.split(/, */)[0]):p();else{var e=(a||"").split(/, */),n=!1;l.options.handleProtocols(e,function(e,r){n=!0,e?p(r):h(t,404,"Unauthorized")});n||h(t,501,"Could not process protocols")}};if("function"==typeof this.options.verifyClient){var d={origin:c,secure:void 0!==e.connection.authorized||void 0!==e.connection.encrypted,req:e};if(2==this.options.verifyClient.length)return void this.options.verifyClient(d,function(e){e?f():h(t,401,"Unauthorized")});if(!this.options.verifyClient(d))return void h(t,401,"Unauthorized")}f()}.apply(this,arguments):h(t,400,"Bad Request")},e.exports=l},function(e,t){e.exports=require("tls")},function(e,t){var n=/^(?:(?![^:@]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,r=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];e.exports=function(e){var t=e,o=e.indexOf("["),i=e.indexOf("]");-1!=o&&-1!=i&&(e=e.substring(0,o)+e.substring(o,i).replace(/:/g,";")+e.substring(i,e.length));for(var s=n.exec(e||""),a={},c=14;c--;)a[r[c]]=s[c]||"";return-1!=o&&-1!=i&&(a.source=t,a.host=a.host.substring(1,a.host.length-1).replace(/;/g,":"),a.authority=a.authority.replace("[","").replace("]","").replace(/;/g,":"),a.ipv6uri=!0),a}},function(e,t){var n=/^[\],:{}\s]*$/,r=/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,o=/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,i=/(?:^|:|,)(?:\s*\[)+/g,s=/^\s+/,a=/\s+$/;e.exports=function(e){return"string"==typeof e&&e?(e=e.replace(s,"").replace(a,""),global.JSON&&JSON.parse?JSON.parse(e):n.test(e.replace(r,"@").replace(o,"]").replace(i,""))?new Function("return "+e)():void 0):null}},function(e,t){e.exports=function(e,t){for(var n=[],r=(t=t||0)||0;r<e.length;r++)n[r-t]=e[r];return n}},function(e,t,n){var r=n(24);e.exports=function(e){return function e(t){if(!t)return!1;if(global.Buffer&&global.Buffer.isBuffer(t)||global.ArrayBuffer&&t instanceof ArrayBuffer||global.Blob&&t instanceof Blob||global.File&&t instanceof File)return!0;if(r(t)){for(var n=0;n<t.length;n++)if(e(t[n]))return!0}else if(t&&"object"==typeof t)for(var o in t.toJSON&&(t=t.toJSON()),t)if(t.hasOwnProperty(o)&&e(t[o]))return!0;return!1}(e)}},function(e,t){var n=Object.prototype.hasOwnProperty;t.keys=Object.keys||function(e){var t=[];for(var r in e)n.call(e,r)&&t.push(r);return t},t.values=function(e){var t=[];for(var r in e)n.call(e,r)&&t.push(e[r]);return t},t.merge=function(e,t){for(var r in t)n.call(t,r)&&(e[r]=t[r]);return e},t.length=function(e){return t.keys(e).length},t.isEmpty=function(e){return 0==t.length(e)}},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(o,i){function s(e){try{c(r.next(e))}catch(e){i(e)}}function a(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(s,a)}c((r=r.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});const o=n(22);function i(e,t,n,r){return function(...i){try{return t.apply(this,i)}catch(t){if(null!=this.logger?this.logger.error(`Calling ${e} failed due to ${t}`,t):o.LogService.defaultLog.error(`Calling ${e} failed due to ${t}`,t),n)return r;throw t}}}function s(e,t,n,i){return function(...s){return r(this,void 0,void 0,function*(){try{const r=t.apply(this,s);return yield r}catch(t){if(null!=this.logger?this.logger.error(`Calling ${e} failed due to ${t}`,t):o.LogService.defaultLog.error(`Calling ${e} failed due to ${t}`,t),n)return i;throw t}})}}t.asynctrycatchlog=function(e=!1,t=null){return(n,r,o,...i)=>null!=o.value||void 0!==o.value?Object.assign({},o,{value:s.apply(this,[r,o.value,e,t])}):Object.assign({},o,{set:s.apply(this,[r,o.set,e,t]),get:s.apply(this,[r,o.get,e,t])})},t.trycatchlog=function(e=!1,t=null){return(n,r,o,...s)=>null!=o.value||void 0!==o.value?Object.assign({},o,{value:i.apply(this,[r,o.value,e,t])}):Object.assign({},o,{set:i.apply(this,[r,o.set,e,t]),get:i.apply(this,[r,o.get,e,t])})}},function(e,t,n){"use strict";var r=this&&this.__decorate||function(e,t,n,r){var o,i=arguments.length,s=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,n,s):o(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s};Object.defineProperty(t,"__esModule",{value:!0});const o=n(0),i=n(122);let s=class{createLogger(e){return new i.CategoryLogger(e)}};s=r([o.singleton()],s),t.LoggerFactory=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(22);t.CategoryLogger=class{constructor(e){this.category=e,this.category.length>10&&r.LogService.defaultLog.debug(`Category ${e} is too big.`)}information(...e){null!=e&&1===e.length&&"string"==typeof e[0]?r.LogService.defaultLog.information(`[INFO ] [${this.category.padEnd(10)}] ${e[0]}`):r.LogService.defaultLog.information(`[INFO ] [${this.category.padEnd(10)}]`,...e)}debug(...e){null!=e&&1===e.length&&"string"==typeof e[0]?r.LogService.defaultLog.information(`[DEBUG] [${this.category.padEnd(10)}] ${e[0]}`):r.LogService.defaultLog.information(`[DEBUG] [${this.category.padEnd(10)}]`,...e)}error(...e){null!=e&&1===e.length&&"string"==typeof e[0]?r.LogService.defaultLog.information(`[ERROR] [${this.category.padEnd(10)}] ${e[0]}`):r.LogService.defaultLog.information(`[ERROR] [${this.category.padEnd(10)}]`,...e)}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TARGET_TEMPERATURE="target_temperature",t.MEASURE_TEMPERATURE="measure_temperature",t.CLASS_THERMOSTAT="thermostat",t.TARGET_TEMPERATURE_MIN=4,t.TARGET_TEMPERATURE_MAX=35},function(e,t,n){"use strict";var r=this&&this.__decorate||function(e,t,n,r){var o,i=arguments.length,s=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,n,s):o(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},o=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},i=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(o,i){function s(e){try{c(r.next(e))}catch(e){i(e)}}function a(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(s,a)}c((r=r.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});const s=n(125),a=n(0),c=n(3);let u=class{constructor(e){this.homeyAPI=null,this.logger=e.createLogger("APISvc")}getInstance(){return i(this,void 0,void 0,function*(){if(null==this.homeyAPI)try{this.logger.debug("Connecting to API"),this.homeyAPI=yield s.HomeyAPI.forCurrentHomey()}catch(e){throw this.logger.console.error("CATASTROPHIC FAILURE **** CANNOT BE HANDELED *****",e),this.homeyAPI=null,e}return this.homeyAPI})}};u=r([a.singleton(),o("design:paramtypes",[c.LoggerFactory])],u),t.HomeyAPIService=u},function(e,t){e.exports=require("athom-api")},function(e,t,n){"use strict";var r=this&&this.__decorate||function(e,t,n,r){var o,i=arguments.length,s=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,n,s):o(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},o=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0});const i=n(10),s=n(2),a=n(0),c=n(3);let u=class{constructor(e){this.logger=e.createLogger("Calculator")}getNextSchedule({schedule:e},t=new Date){if(this.logger.debug(`Searching next trigger for ${i.Day[t.getDay()]}@${t.getHours()}:${t.getMinutes()}`),null==e||0===e.length)return null;const n=s.sortBy(e,[e=>this.transposeDay(e.day),"hour","minute"]),r=this.findLastIndex(n,t);let o;o=r+1<n.length?n[r+1]:n[0],this.logger.debug(`> set point is ${i.Day[o.day]}@${o.hour}:${o.minute}`);const a=t;a.setHours(o.hour,o.minute,0,0);let c=0;return c=o.day===t.getDay()?0:this.transposeDay(o.day)>this.transposeDay(t.getDay())?this.transposeDay(o.day)-this.transposeDay(t.getDay()):7-this.transposeDay(t.getDay())+this.transposeDay(o.day),a.setDate(t.getDate()+c),this.logger.debug(`> calculated date is ${a.toLocaleString()}`),a}getSetPoint({schedule:e},t=new Date){if(this.logger.debug(`Investigating ${i.Day[t.getDay()]}@${t.getHours()}:${t.getMinutes()}`),null==e||0===e.length)return null;const n=s.sortBy(e,[e=>this.transposeDay(e.day),"hour","minute"]);let r=this.findLastIndex(n,t);if(-1===r){this.logger.debug("> No trigger for today, looking at yesterday");const e=t;if(e.setDate(t.getDate()-1),e.setHours(23,59),-1===(r=this.findLastIndex(n,e)))return null}const o=n[r];return this.logger.debug(`> Target temperature is ${o.targetTemperature} (${i.Day[o.day]}@${o.hour}:${o.minute})`),o}findLastIndex(e,t){return s.findLastIndex(e,e=>{if(this.transposeDay(t.getDay())>this.transposeDay(e.day))return!0;if(this.transposeDay(t.getDay())===this.transposeDay(e.day)){if(t.getHours()>e.hour)return!0;if(t.getHours()===e.hour&&t.getMinutes()>=e.minute)return!0}return!1})}transposeDay(e){return e===i.Day.Sunday?7:e}};u=r([a.injectable(),o("design:paramtypes",[c.LoggerFactory])],u),t.HeatingPlanCalculator=u},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}(n(128))},function(e,t,n){"use strict";var r=this&&this.__decorate||function(e,t,n,r){var o,i=arguments.length,s=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,n,s):o(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},o=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},i=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(o,i){function s(e){try{c(r.next(e))}catch(e){i(e)}}function a(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(s,a)}c((r=r.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});const s=n(6),a=n(10),c=n(5),u=n(2),l=n(0),h=n(30),p=n(53),f=n(31),d=n(3);let g=class{constructor(e,t,n,r){this.manager=e,this.calculator=t,this.repository=n,this.mutex=new s.Mutex,this.next=null,this.logger=r.createLogger("Scheduler"),this.repository.onChanged.subscribe(()=>i(this,void 0,void 0,function*(){yield this.start()}))}get nextSchedule(){return this.next}stop(){return i(this,void 0,void 0,function*(){const e=yield this.mutex.lock();try{this.logger.information("Stop"),yield c.ManagerCron.unregisterAllTasks()}finally{e()}})}start(){return i(this,void 0,void 0,function*(){const e=yield this.mutex.lock();try{this.logger.information("Start"),yield this.registerTasks()}finally{e()}})}run(e){return i(this,void 0,void 0,function*(){try{e&&(this.logger.information("Reverting to normal mode"),this.manager.operationMode=a.NormalOperationMode.Automatic),this.logger.information("Execute"),this.manager.applyPlans()}finally{this.registerTasks()}})}registerTasks(){return i(this,void 0,void 0,function*(){if(this.logger.debug("Updating Cron"),yield c.ManagerCron.unregisterAllTasks(),this.manager.operationMode===a.OverrideMode.Holiday||this.manager.operationMode===a.OverrideMode.OutOfSeason)return void this.logger.information(`Mode is ${a.OverrideMode[this.manager.operationMode]}, no check required.`);let e=!1;const t=[];if(this.manager.operationMode===a.OverrideMode.DayAtHome||this.manager.operationMode===a.OverrideMode.Sleep||this.manager.operationMode===a.OverrideMode.DayAway){const n=new Date;n.setHours(0,0,0,0),n.setDate(n.getDate()+1),e=!0,t.push(n)}else{(yield this.repository.activePlans).forEach(e=>{this.logger.debug(`Checking plan ${e.id}`);const n=this.calculator.getNextSchedule(e);null!=n&&t.push(n)})}this.next=u.first(u.sortBy(t,e=>e)),null!=this.next?(this.logger.information(`Next execution is at ${this.next.toLocaleString()}`),(yield c.ManagerCron.registerTask("HeatingManagerService",this.next,e)).once("run",e=>{this.run(e)})):this.logger.information("No execution planned.")})}};r([d.trycatchlog(!0,null),o("design:type",Date),o("design:paramtypes",[])],g.prototype,"nextSchedule",null),r([d.asynctrycatchlog(!0),o("design:type",Function),o("design:paramtypes",[]),o("design:returntype",Promise)],g.prototype,"stop",null),r([d.asynctrycatchlog(!0),o("design:type",Function),o("design:paramtypes",[]),o("design:returntype",Promise)],g.prototype,"start",null),r([d.asynctrycatchlog(!0),o("design:type",Function),o("design:paramtypes",[Boolean]),o("design:returntype",Promise)],g.prototype,"run",null),g=r([l.singleton(),o("design:paramtypes",[p.HeatingManagerService,h.HeatingPlanCalculator,f.HeatingPlanRepositoryService,d.LoggerFactory])],g),t.HeatingSchedulerService=g},function(e,t,n){"use strict";var r=this&&this.__decorate||function(e,t,n,r){var o,i=arguments.length,s=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,n,s):o(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},o=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},i=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(o,i){function s(e){try{c(r.next(e))}catch(e){i(e)}}function a(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(s,a)}c((r=r.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});const s=n(2),a=n(0),c=n(52),u=n(3);t.CanSetTargetTemperature=(e=>null!=e.capabilities&&null!=e.capabilities.find(e=>e===c.TARGET_TEMPERATURE)),t.CanMeasureTemperature=(e=>null!=e.capabilities&&null!=e.capabilities.find(e=>e===c.MEASURE_TEMPERATURE));let l=class{constructor(e,t){this.apiService=e,this.initialized=!1,this.logger=t.createLogger("AthomAPI")}get zones(){return this.zoneList||{}}get devices(){return this.deviceList||{}}init(){return i(this,void 0,void 0,function*(){if(this.initialized)return;this.logger.information("Init"),this.homeyApi=yield this.apiService.getInstance();const e=s.filter(yield this.homeyApi.devices.getDevices(),e=>t.CanSetTargetTemperature(e));this.logger.information(`Found ${e.length} devices`),this.deviceList={},yield Promise.all(e.map(e=>i(this,void 0,void 0,function*(){yield this.attachWatchers(e),this.deviceList[e.id]=e}))),this.zoneList=yield this.homeyApi.zones.getZones(),this.logger.information(`Found ${Object.keys(this.zoneList).length} zones`),this.homeyApi.devices.on("device.create",e=>i(this,void 0,void 0,function*(){if(!t.CanSetTargetTemperature(e))return void this.logger.information(`Device ${e.id} was created but cannot set temperature -> ignored`);this.logger.debug(`Device ${e.id} was created.`);const n=yield this.homeyApi.devices.getDevice({id:e.id});this.deviceList[e.id]=n,yield this.attachWatchers(n)})),this.homeyApi.devices.on("device.update",e=>i(this,void 0,void 0,function*(){const n=this.deviceList[e.id];if(null!=n&&(yield this.destroyWatchers(n)),!t.CanSetTargetTemperature(e))return this.logger.information(`Device ${e.id} was updated but cannot set temperature -> ignored`),void delete this.deviceList[e.id];this.logger.debug(`Device ${e.id} was updated.`);const r=yield this.homeyApi.devices.getDevice({id:e.id});this.deviceList[e.id]=r,yield this.attachWatchers(r)})),this.homeyApi.devices.on("device.delete",e=>i(this,void 0,void 0,function*(){this.logger.debug(`Device ${e.id} was removed.`),yield this.destroyWatchers(this.deviceList[e.id]),delete this.deviceList[e.id]})),this.homeyApi.zones.on("zone.create",e=>{this.logger.debug(`Zone ${e.id} was created.`),this.zoneList[e.id]=e}),this.homeyApi.zones.on("zone.update",e=>{this.logger.debug(`Zone ${e.id} was updated.`),this.zoneList[e.id]=e}),this.homeyApi.zones.on("zone.delete",e=>{this.logger.debug(`Zone ${e.id} was removed.`),delete this.zoneList[e.id]}),this.initialized=!0})}findZone(e){return this.zoneList[e]}getTargetTemperature(e){const t=e.watchedCapabilities.targetTemperature;return null!=t?t.value:0}getMeasuredTemperature(e){const t=e.watchedCapabilities.temperature||e.watchedCapabilities.targetTemperature;return null!=t?t.value:0}setTargetTemperature(e,t){return i(this,void 0,void 0,function*(){let n=t;const r=e.watchedCapabilities.targetTemperature;null!=r&&(n=n>r.max?r.max:n<r.min?r.min:0===r.step?Math.round(n):Math.round(n/r.step)*r.step,t!==n&&this.logger.information(`Target adjusted ${e.name} (${e.name}) was ${t} -> ${n} (min: ${r.min}, max: ${r.max}, step: ${r.step})`)),yield this.homeyApi.devices.setCapabilityValue({deviceId:e.id,capabilityId:c.TARGET_TEMPERATURE,value:n})})}findDevice(e){return(this.deviceList||[])[e]}getDevicesForZone(e){return s.filter(this.deviceList||[],t=>t.zone===e)}attachWatchers(e){return i(this,void 0,void 0,function*(){null==e.watchedCapabilities&&(e.watchedCapabilities={}),null==e.watchedCapabilities.targetTemperature&&(this.logger.information(`Listening on ${e.id} (${e.name}) ${c.TARGET_TEMPERATURE}`),e.watchedCapabilities.targetTemperature=yield e.makeCapabilityInstance(c.TARGET_TEMPERATURE,t=>{this.logger.debug(`${e.name} (${e.id}) changed ${c.TARGET_TEMPERATURE} to ${t}`)})),null==e.watchedCapabilities.temperature&&t.CanMeasureTemperature(e)&&(this.logger.information(`Listening on ${e.id} (${e.name}) ${c.MEASURE_TEMPERATURE}`),e.watchedCapabilities.temperature=yield e.makeCapabilityInstance(c.MEASURE_TEMPERATURE,t=>{this.logger.debug(`${e.name} (${e.id}) changed ${c.MEASURE_TEMPERATURE} to ${t}`)}))})}destroyWatchers(e){return i(this,void 0,void 0,function*(){null!=e&&null!=e.watchedCapabilities&&(null!=e.watchedCapabilities.targetTemperature&&e.watchedCapabilities.targetTemperature.destroy(),null!=e.watchedCapabilities.temperature&&e.watchedCapabilities.temperature.destroy())})}};r([u.trycatchlog(!0,0),o("design:type",Function),o("design:paramtypes",[Object]),o("design:returntype",Number)],l.prototype,"getTargetTemperature",null),r([u.trycatchlog(!0,0),o("design:type",Function),o("design:paramtypes",[Object]),o("design:returntype",Number)],l.prototype,"getMeasuredTemperature",null),r([u.asynctrycatchlog(!0),o("design:type",Function),o("design:paramtypes",[Object]),o("design:returntype",Promise)],l.prototype,"attachWatchers",null),r([u.asynctrycatchlog(!0),o("design:type",Function),o("design:paramtypes",[Object]),o("design:returntype",Promise)],l.prototype,"destroyWatchers",null),l=r([a.singleton(),o("design:paramtypes",[c.HomeyAPIService,u.LoggerFactory])],l),t.DeviceManagerService=l},function(e,t,n){"use strict";var r,o,i=this&&this.__decorate||function(e,t,n,r){var o,i=arguments.length,s=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,n,s):o(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},s=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},a=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(o,i){function s(e){try{c(r.next(e))}catch(e){i(e)}}function a(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(s,a)}c((r=r.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});const c=n(6),u=n(0),l=n(11),h=n(54),p=n(55),f=n(13);let d=r=class{constructor(e,t){const n=parseInt(t.get(l.InternalSettings.SetTemperatureThrottle,"2000"),10);this.setMethod=c.AsyncThrottle((t,n)=>a(this,void 0,void 0,function*(){return yield e.setTargetTemperature(t,n)}),n)}setTargetTemperature(e,t){return a(this,void 0,void 0,function*(){return yield this.setMethod(e,t)})}};d=r=i([u.injectable(),u.registry([{token:f.PolicyType.Throttled_Enforce,useToken:r}]),s("design:paramtypes",[p.EnforceTemperaturePolicy,l.SettingsManagerService])],d);let g=o=class{constructor(e,t){const n=parseInt(t.get(l.InternalSettings.SetTemperatureThrottle,"2000"),10);this.setMethod=c.AsyncThrottle((t,n)=>a(this,void 0,void 0,function*(){return yield e.setTargetTemperature(t,n)}),n)}setTargetTemperature(e,t){return a(this,void 0,void 0,function*(){return yield this.setMethod(e,t)})}};g=o=i([u.injectable(),u.registry([{token:f.PolicyType.Throttled_CheckTemperature,useToken:o}]),s("design:paramtypes",[h.CheckTemperaturePolicy,l.SettingsManagerService])],g)},function(e,t,n){"use strict";var r=this&&this.__decorate||function(e,t,n,r){var o,i=arguments.length,s=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,n,s):o(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},o=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},i=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(o,i){function s(e){try{c(r.next(e))}catch(e){i(e)}}function a(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(s,a)}c((r=r.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});const s=n(10),a=n(5),c=n(2),u=n(0),l=n(30),h=n(20),p=n(31),f=n(3),d=n(11),g=n(13);let y=class{constructor(e,t,n,r,o){this.plans=e,this.calc=t,this.deviceManager=n,this.settings=r,this.logger=o.createLogger("Manager");const a=this.settings.get(d.InternalSettings.OperationMode,s.NormalOperationMode.Automatic);this.mode=a,this.plans.onChanged.subscribe(()=>i(this,void 0,void 0,function*(){try{yield this.applyPlans()}catch(e){this.logger.error("Refresh of plans failed.",e)}})),this.policy=u.container.resolve(this.settings.get(d.InternalSettings.SetTemperaturePolicy,g.PolicyType.Throttled_CheckTemperature))}get operationMode(){return this.mode}set operationMode(e){this.logger.information("Setting mode to",e),this.mode=e,this.settings.set(d.InternalSettings.OperationMode,e),this.sendNotification("set_operation_mode",{mode:a.__(`Modes.${e}`)})}applyPlans(){return i(this,void 0,void 0,function*(){if(!this.isRunning)try{this.isRunning=!0,this.logger.debug("Applying active plans");const e=yield this.evaluateActivePlans();yield this.applySettings(e)}finally{this.isRunning=!1}})}evaluateActivePlans(){return i(this,void 0,void 0,function*(){const e=[];return c.forEach(yield this.plans.activePlans,t=>{e.push(...this.evaluatePlan(t))}),e})}applyPlan(e){return i(this,void 0,void 0,function*(){yield this.applySettings(yield this.evaluatePlan(e))})}applySettings(e){return i(this,void 0,void 0,function*(){yield Promise.all(e.map(e=>i(this,void 0,void 0,function*(){return yield this.setTemperature(e.plan.name,this.deviceManager.findDevice(e.device.id),e.targetTemperature)})))})}evaluatePlan(e){this.logger.information(`Evaluating plan ${e.id}`);let t=null;const n=e.overrides?e.overrides[this.mode]||e.overrides[s.OverrideMode[this.mode]]:null;if(null!=n){this.logger.debug(`> Plan has override for ${s.OverrideMode[this.mode]}`);const e=new Date;t={day:e.getDay(),hour:e.getHours(),minute:e.getMinutes(),targetTemperature:n.targetTemperature}}else if(null==(t=this.calc.getSetPoint(e)))return[];this.logger.debug(`> Target temperature is ${t.targetTemperature}`);const r=[];let o=t.targetTemperature;return"number"!=typeof o&&(this.logger.debug("Setpoint has wrong datatype for temperature, trying to correct",t),NaN===(o=parseFloat(o)))?(this.logger.error("Setpoint has wrong datatype for temperature",t),[]):(e.zones&&c.forEach(e.zones,t=>{this.logger.debug(`Evaluating zone ${t}`);const n=this.deviceManager.findZone(t);if(null==n)return void this.logger.debug("> not found");const i=this.deviceManager.getDevicesForZone(n.id);c.isEmpty(i)?this.logger.debug("> No devices found"):(this.logger.debug(`> found ${i.length} device(s)`),c.forEach(i,t=>{r.push({device:{id:t.id,name:t.name},plan:{id:e.id,name:e.name},temperature:this.deviceManager.getMeasuredTemperature(t),targetTemperature:o})}))}),e.devices&&c.forEach(e.devices,t=>{this.logger.debug(`Evaluating device ${t})`);const n=this.deviceManager.findDevice(t);null!=n?r.push({device:{id:n.id,name:n.name},plan:{id:e.id,name:e.name},temperature:this.deviceManager.getMeasuredTemperature(n),targetTemperature:o}):this.logger.debug("> not found")}),r)}setTemperature(e,t,n){return i(this,void 0,void 0,function*(){const r=yield this.policy.setTargetTemperature(t,n);r.success?r.skipped||this.sendNotification("set_target_temperature",{name:t.name,value:n,plan:e}):this.sendNotification("failed_set_target_temperature",{name:t.name,value:n,error:r.error})})}sendNotification(e,t){new a.Notification({excerpt:a.__(`Notification.${e}`,t)}).register()}};r([f.trycatchlog(!0,s.NormalOperationMode.Automatic),o("design:type",Number),o("design:paramtypes",[Number])],y.prototype,"operationMode",null),y=r([u.singleton(),o("design:paramtypes",[p.HeatingPlanRepositoryService,l.HeatingPlanCalculator,h.DeviceManagerService,d.SettingsManagerService,f.LoggerFactory])],y),t.HeatingManagerService=y},function(e,t,n){"use strict";var r=this&&this.__decorate||function(e,t,n,r){var o,i=arguments.length,s=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,n,s):o(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},o=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},i=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(o,i){function s(e){try{c(r.next(e))}catch(e){i(e)}}function a(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(s,a)}c((r=r.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});const s=n(6),a=n(2),c=n(32),u=n(0),l=n(3),h=n(11);let p=class{constructor(e,t){this.settings=e,this.planList=[],this.mutex=new s.Mutex,this.changed=!1,this.onChangedDispatcher=new c.EventDispatcher,this.logger=t.createLogger("Repository"),this.settings.onChanged.subscribe((e,t)=>{if(this.changed)this.changed=!1;else if(t.setting===h.Settings.Plans){this.logger.information("Reload due to settings change.");try{this.load(),this.onChangedDispatcher.dispatch(this,this.planList)}catch(t){this.logger.information("Reload of plans failed",t)}}})}replacePlans(e){this.planList=e||[],this.save()}load(){const e=this.settings.get(h.Settings.Plans);this.planList=null==e?[]:JSON.parse(e)}save(){this.changed=!0,this.settings.set(h.Settings.Plans,JSON.stringify(this.planList))}get plans(){return this.mutex.lock().then(e=>{const t=this.planList;return e(),t})}get activePlans(){return this.mutex.lock().then(e=>{const t=a.filter(this.planList,e=>e.enabled);return e(),t})}get onChanged(){return this.onChangedDispatcher.asEvent()}find(e){return i(this,void 0,void 0,function*(){return this.mutex.lock().then(t=>{const n=a.find(this.planList,t=>t.id===e);return t(),n})})}update(e){return i(this,void 0,void 0,function*(){const t=yield this.mutex.lock();this.logger.debug(`Updating plan ${e.id}`),a.remove(this.planList,t=>t.id===e.id),this.planList.push(e),this.save(),t(),this.onChangedDispatcher.dispatch(this,[e])})}add(e){return i(this,void 0,void 0,function*(){const t=yield this.mutex.lock();this.logger.debug(`Adding plan ${e.id}`),this.planList.push(e),this.save(),t(),this.onChangedDispatcher.dispatch(this,[e])})}remove(e){return i(this,void 0,void 0,function*(){let t;const n=yield this.mutex.lock();this.logger.debug(`Removing plan ${e}`),t=a.find(this.planList,t=>t.id===e),a.remove(this.planList,t=>t.id===e),this.save(),n(),this.onChangedDispatcher.dispatch(this,[t])})}};r([l.asynctrycatchlog(!0,[]),o("design:type",Promise),o("design:paramtypes",[])],p.prototype,"plans",null),r([l.asynctrycatchlog(!0,[]),o("design:type",Promise),o("design:paramtypes",[])],p.prototype,"activePlans",null),p=r([u.singleton(),o("design:paramtypes",[h.SettingsManagerService,l.LoggerFactory])],p),t.HeatingPlanRepositoryService=p}]);
//# sourceMappingURL=services.js.map